<!doctype html>
<meta charset="utf-8">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR&display=swap');

    body {
        margin: 0;
        padding: 10vw;
        font-family: sans-serif;
    }
    
    #bg {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        opacity: 0.2;
    }
    
    #content {
        position: absolute;
        left: 0px;
        top: 0px;
        width: 100vw;
    }
    
    h1 {
        font-size: 6vh;
        text-align: center;
    }
    
    p {
        font-size: 2.5vh;
        line-height: 1.5em;
    }
    
    .desc {
        margin-left: auto;
        margin-right: auto;
        width: 700px;
        color: slategray;
        text-align: left;
    }

    .story {
        margin-left: auto;
        margin-right: auto;
        width: 700px;
    }

    .story p {
        color: rgb(0, 0, 0);
        font-size: 2vh;
        text-align: left;
    }
    
    strong {
        background-color: yellow;
        /* padding: 5px; */
        /* border-radius: 5px; */
    }
    
    hr {
        border: 1px dashed #b9d100;
        width: 700px;
    }
    
    .desc .magic {
        display: block;
        color: #3e86f8;
        margin-top: 15px;
        margin-bottom: 15px;
        font-style: italic;
        text-shadow: 0px 0px 5px #c1e0ff;
        text-align: center;
    }
    
    .hint {
        color: black;
        text-align: center;
    }
    
    .notice {
        color: #6c2aff;
        text-align: left;
        font-size: 1.5vh; 
    }
    
    .intro {
        color: dimgray;
        text-align: center;
    }

    .title {
        font-family: 'Noto Serif KR', serif;
        color: rgb(4, 84, 30);
        text-align: center;
        text-shadow: 0px 0px 10px #f5fe92;
        font-size: 3vh;
    }
    
    .qr {
        height: 10vh;
        margin-bottom: 5vh;
    }
    
    .qr svg {
        -webkit-animation: rot 3s ease-in-out;
        animation: rot 3s ease-in-out;
    }
    
    .visual img {
        display: block;
        width: 700px;
        margin: auto;
        border-radius: 1vh;
        /* mix-blend-mode: multiply; */
        /* box-shadow: 0px 0px 20px white; */
        /* visibility: hidden; */
    }
    
    .bottom {
        width: 700px;
        margin: auto;
    }
    
    .found {
        text-align: center;
    }
    
    .got {
        margin: 5px 10px 5px 10px;
        padding: 3px;
        background-color: yellow;
        color: slategray;
        font-size: 2vh;
        border-radius: 10px;
    }
    
    .alert {
        color: red;
        text-align: left;
        font-size: 1.5vh; 
    }
    
    .solve {
        text-align: center;
        margin-top: 4vh;
        margin-bottom: 4vh;
    }
    
    .solve-riddle {
        text-align: center;
        margin: auto;
        padding: 10px 20px 10px 20px;
        /* width: 200px; */
        height: 4vh;
        line-height: 4vh;
        font-size: 3vh;
        border-radius: 15px;
        background-color: aquamarine;
        color: cadetblue;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
    }
    
    .solve-riddle:active {
        background-color: aqua;
    }
    
    .solve-riddle a {
        text-decoration: none;
        color: cadetblue;
    }
    
    @-webkit-keyframes appear {
        from { opacity: 0} to { opacity: 1 }
    }
    
    @keyframes appear {
        from { opacity: 0} to { opacity: 1 }
    }
    
    @-webkit-keyframes rot {
        from { transform: rotate(0deg)} to { transform: rotate(1080deg) }
    }
    
    @keyframes rot {
        from { transform: rotate(0deg)} to { transform: rotate(1080deg) }
    }
</style>
<body>
    <canvas id="bg"></canvas>
    <div id="content"></div>
</body>
<script src="./qrcode.min.js"></script>
<script>
    let el_bg = document.querySelector('#bg');
    let el_content = document.querySelector('#content');
    
    let g = el_bg.getContext('2d');
    
    function layout() {
        g.canvas.width = innerWidth;
        g.canvas.height = innerHeight;
    }
    
    function init() {
        layout();
        
        /*
        let params = new URLSearchParams(location.search.slice(1));
        let title = params.get('w');
        let desc = '?';
        let hint = '???';
        
        //console.log(params.get('w'));
        
        switch(params.get('w')) {
            case 'A1_m9dc':
            desc = `어느 평화로운 마을에 조금은 무서운 일이났어. 코로일구라는 괴물들이 마을을 습격한거야! 그 마을에는 요술 <strong>모자를 쓴</strong> 아이가 있었어. 바로 목화였지. 모자를 쓴 목화는 코로일구가 잠든 사이에 마을 사람들을 안전한 곳으로 데려다 주었어.`;
            hint = '';
            break;
            case 'A2_c50y':
            desc = `다음 날, 코로일구가 마을에 다시 나타나자 목화는 코로일구를 물리칠 방법을 생각했어. 그러던 중 주변에 주렁주렁 열려있던 <strong>열매가</strong> 눈에 띄었지. 한참을 고민하던 목화는 주문을 외우기 시작했어. <span class="magic">뚜뚜따리 뚜뚜따리 얍~</span>`;
            hint = '';
            break;
            case 'A3_p5y6':
            desc = `목화가 주문을 외우자 마을에 있던 열매들이 슝~ 날아와서 마을 주변으로 모였어. <strong>다닥다닥 붙은</strong> 열매들은 동그랗게 마을에 보호막을 만들기 시작했어. 목화는 주문을 한번 더 외웠어. <span class="magic">뚜뚜따리 뚜뚜따리 얍~</span> 그러자 열매에서 환한 빛이 나오더니 코로일구가 먼지처럼 사라졌어! 코로일구가 사라지자 목화는 다시 주문을 외웠어 <span class="magic">뚜뚜따리 뚜뚜따리 얍~</span><br>`;
            hint = '';
            break;
            case 'A4_06ch':
            desc = `그러자 열매들이 다시 슝~ 하고 나무로 돌아갔어. <strong>나무는</strong> 열매들이 돌아오자 마법의 힘을 얻어 쑥쑥 자라나고 더 맑은 공기를 만들어내서 코로일구같은 나쁜 바이러스들이 더이상 오지 못했대~`;
            hint = '';
            break;
            case 'A5_51j8':
            desc = `그런데 코로일구가 갑자기 마을을 공격한 이유는 <strong>무엇일까?</strong> 정말 궁금하지 않니?`;
            hint = '';
            break;
            case 'B1_6g67':
            desc = `<strong>나</strong>는 노는게 제일 좋아.<br>가능성으로 가득 차 있어.`;
            hint = '';
            break;
            case 'B2_4rd2':
            desc = `하고 싶은 것도 많아.<br>나<strong>는</strong> 참 다채로워.`;
            hint = '';
            break;
            case 'B3_5f89':
            desc = `나는 <strong>누구</strong>와도 친구가 될 수 있지.<br>무척 호기심이 많아.`;
            hint = '';
            break;
            case 'B4_zp0s':
            desc = `나는 이제 다섯 살, 여섯 살, 그리고 <strong>일</strong>곱 살이 됐어.<br>금방 쑥쑥 자라지.`;
            hint = '';
            break;
            case 'B5_0r74':
            desc = `어른들은 날 어리다고 말하지만 <span class="magic">내 생각은 하늘까지 우주<strong>까</strong>지 닿아.</span> 나는 지금이 좋아.`;
            hint = '';
            break;
            case 'C1_3poh':
            desc = `알을 깨고 나온 날, 눈이 마주친 <strong>나를</strong> 보고 기뻐하며 인사하던 아빠 얼굴이 떠올라요.`;
            hint = '';
            break;
            case 'C2_1x29':
            desc = `엄마가 <strong>낳은</strong> 알 속에서부터 따뜻하게 품어주셨던 사랑을 느끼고 있었죠.</p>`;
            hint = '';
            break;
            case 'C3_ru90':
            desc = `<strong>두 분</strong>이 함께 행복한 우리 가족 둥지를 꾸며주셨어요.`;
            hint = '';
            break;
            case 'C4_66em':
            desc = `그때 저는 언젠가 엄마 아빠처럼 멋지게 하늘을 날고 싶다고 <strong>생각하는</strong> 작은 새였습니다.`;
            hint = '';
            break;
            case 'C5_q6wk':
            desc = `이제 날개에 힘에 생겨 훨훨 하늘을 <strong>날</strong>다 드문드문 보이는 새 둥지를 보면, <span class="magic">그때 그 따스함이 생각나곤 합니다.</span>`;
            hint = '';
            break;
        }
        */
        
        //let category = title[0];
        let category = 'A';
        let colors = {
            A: '#000000',
            B: '#2A8000',
            C: '#0061EA',
        };
        
        let qrcode = new QRCode({
            content: location.href,
            ecl: 'L',
            padding: 0,
            width: 100,
            height: 100,
            color: colors[category],
            background: "#ffffff00",
        });
        
        let svg_str = qrcode.svg();
        
        //let index = title[1];
        let index = '1';
        //let id = title.slice(0, 2);
        let id = 'A1';
        
        // 다섯 개 중 첫 번째 이야기 조각을 찾았습니다!
        let nth = {
            1: '첫',
            2: '두',
            3: '세',
            4: '네',
            5: '다섯',
        }
        
        localStorage.setItem(id, 'found:' + Date.now());
        
        let riddle = {
            A: '모자를 쓴,열매가,다닥다닥 붙은,나무는,무엇일까?'.split(','),
            B: '나,는,누구,일,까'.split(','),
            C: '나를,낳은,두 분,생각하는,날'.split(','),
        };
        
        let solved = '?,?,?,?,?'.split(',');
        
        let count_found = 0;
        let last_t = Number.MAX_SAFE_INTEGER;
        for(let i = 0; i < 5; i++) {
            let vt = localStorage.getItem(category + (i + 1));
            if(vt) {
                let [v, t] = vt.split(':');
                last_t = Math.min(last_t, Number(t));
                if(v === 'found') {
                    solved[i] = riddle[category][i]; 
                    count_found += 1;
                }  
            }
        }
        
        let elapsed = Date.now() - last_t;
        if(elapsed > 1000 * 3600 * 2) {
            localStorage.clear();
            localStorage.setItem(id, 'found:' + Date.now());
        }

        let desc = `
        <div class="story">
            <p>옛날 옛날, 한 작은 마을에 특별한 나무가 하나 있었어요. 이 나무는 다른 나무들과 달리 빛나는 나무였답니다. 그냥 햇빛에 반짝이는 그런 빛이 아니라, 진짜로 마법처럼 빛나는 나무랍니다! 그럼 왜 그렇게 빛났을까요?</p>
            <div class="visual">
                <img src="./img/2023/intro_1.jpg">
            </div>
            <p>그 이유는 이 나무가 매우 특별한 씨앗에서 자라난 빛나는 열매가 열리는 나무였기 때문이죠.</p>
            <div class="visual">
                <img src="./img/2023/intro_2.png">
            </div>
            <p>어떤 열매는 왜 하늘은 파란색인지에 대한 이야기를 가지고 있었고, 또 다른 열매는 무지개가 어떻게 만들어지는지에 대한 이야기를 가지고 있었어요. 공룡은 어떻게 생겼는지에 관한 이야기를 담은 열매도 있었습니다.</p>
            <div class="visual">
                <img src="./img/2023/intro_3.jpg">
            </div>
            <p>그런데, 나무는 자신이 가진 이야기를 마을 어린이들에게 공유하고 싶어도, 열매를 직접 줄 수가 없었어요. 그래서 똑똑한 방법을 생각해냈죠. 바로 새들의 도움을 받는 것이었습니다.</p>
            <div class="visual">
                <img src="./img/2023/intro_4.jpg">
            </div>
            <p>나무가 피워낸 꽃의 향기와 열매의 빛에 모여든 새들은 이야기 조각을 담은 열매를 마을 구석구석에 숨겼어요.</p>
            <div class="visual">
                <img src="./img/2023/intro_5.jpg">
            </div>
            <p>지금도, 그 나무의 이야기는 우리 마을 곳곳에서 찾을 수 있답니다. 이 이야기를 찾는 것은 어렵지 않아요. 그냥 주변을 잘 보면, 그 흔적을 발견할 수 있을 거예요.</p>
        </div>
        `;
        
        let template = `
        <p class="title">빛나는 나무</p>
        <!--
        <h1 style="color: ${colors[category]}">${index}/5</h1>
        <div class="qr">${svg_str}</div>
        <div class="visual">
            <img src="./img/2020/${id}.jpg">
        </div>
        -->
        <p class="desc">${desc}</p>
        <hr>
        <div class="bottom">
            <!--
            <p class="notice">위 이야기 글을 옮겨 적거나 캡처해서 수수께끼를 풀 때 활용하세요. 모든 이야기 조각을 모아 합쳐보면, 수수께끼(<strong>노란색으로 강조한 글들을 합치면</strong>)가 만들어집니다. 지금까지 ${count_found}개의 조각을 찾았습니다.</p>
            <div class="found">
                <span class="got">${solved[0]}</span>
                <span class="got">${solved[1]}</span>
                <span class="got">${solved[2]}</span>
                <span class="got">${solved[3]}</span>
                <span class="got">${solved[4]}</span>
            </div>
            <p class="notice">아래 버튼을 눌러 그 수수께끼를 풀어보세요.</p>
            <p class="alert">( 수수께끼를 푸는 이벤트는 종료했습니다. )</p>
            -->
            <p>.</p>
            <div class="qr">${svg_str}</div>
            <div class="solve">
                <span class="solve-riddle"><a href="https://forms.gle/gTsfJWWBoKojrBDP8" target="_blank">수수께끼 풀기</a></span>
            </div>
        </div>
        `;
        
        el_content.innerHTML = template;
        
        let svg = el_content.querySelector('svg');
        svg.setAttribute('width', '100%');
        svg.setAttribute('height', '100%');
        svg.setAttribute('viewBox', '0 0 100 100');
        
        /*
        let img = el_content.querySelector('.visual img');
        img.onload = function() {
            img.style['-webkit-animation'] = 'appear 3s ease-in-out';
            img.style['animation'] = 'appear 3s ease-in-out';
            img.style['visibility'] = 'visible';
        };
        */
        
        loop();
    }
    
    let frame_count = 0;
    
    let pxs = [Math.random() * g.canvas.width, Math.random() * g.canvas.width, Math.random() * g.canvas.width];
    let pys = [Math.random() * g.canvas.height, Math.random() * g.canvas.height, Math.random() * g.canvas.height];
    let prs = [10 + Math.random() * g.canvas.height * 0.1, 10 + Math.random() * g.canvas.height * 0.1, 10 + Math.random() * g.canvas.height * 0.1];
    let hue = Math.random() * 360;
    
    function draw(timestamp) {
        if(frame_count < 3000) {
            for(let i = 0; i < 3; i++) {
                if(frame_count % 30 === 0) {
                    pxs[i] = Math.random() * g.canvas.width;
                    pys[i] = Math.random() * g.canvas.height;
                    prs[i] = 10 + Math.random() * g.canvas.height * 0.1;  
                }
                g.beginPath();
                g.arc(pxs[i], pys[i], prs[i], 0, Math.PI*2);
                hue = (Math.sin(timestamp * 0.001) * 0.5 + 0.5) * 360 | 0;
                g.fillStyle = `hsla(${hue}, 100%, 50%, 0.01)`;
                g.fill();
                prs[i] += 1;  
            }
        }
    }
    
    function loop(timestamp) {
        draw(timestamp);
        frame_count += 1;
        requestAnimationFrame(loop);
    }
    
    window.onload = init;
    window.onresize = layout;
</script>