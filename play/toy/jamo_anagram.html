<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1">
<title>í•œê¸€ ìëª¨ ì„ì–´ ë§ì¶”ê¸°</title>
<style>
    body {
        overflow: hidden;
        touch-action: none;
        user-select: none;
        -webkit-user-select: none;
    }

    #showhide {
        display: inline-block;
        font-size: 1.2em;
        transform: translateY(0.1em);
        cursor: pointer;
        margin-right: 0.1em;
    }

    #showhide:hover {
        text-shadow: 0px 0px 10px cyan;
    }

    #answer {
        color: rgba(0, 0, 0, 1.0);
    }

    #stage {
        position: absolute;
        left: 0px;
        top: 0px;
    }

    .jamo {
        position: absolute;
        width: 10px;
        height: 10px;
        font-size: 100px;
        font-family: sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        /* border: 1px solid rgba(0, 0, 0, 0.25); */
        user-select: none;
        -webkit-user-select: none;
        cursor: pointer;
        transition: text-shadow 0.5s;
    }

    /* .jamo:hover {
        -webkit-text-stroke: 3px blue;
        color: blue;
    } */

    #ui-top {
        position: absolute;
        left: 20px;
        top: 20px;
        line-height: 2em;
    }

    #ui-bottom {
        position: absolute;
        right: 20px;
        bottom: 20px;
        text-align: right;
    }

    #info {
        position: absolute;
        left: 0px;
        top: 90px;
        padding-left: 10px;
        padding-right: 10px;
        background-color: white;
        border-top: 1px solid gray;
        font-family: sans-serif;
    }

    #info > ul > li {
        margin-top: 0.3em;
        line-height: 1.25em;
        font-size: 0.8em;
    }

    #test {
        font-family: sans-serif;
        text-align: right;
    }

    #test > a:visited {
        color: LinkText;
    }
</style>
<body>
    <div id="stage">
        <!--<div class="jamo" style="left: 200px; top: 300px">ã…</div>-->
    </div>
    <div id="ui-top">
        <span id="showhide">ğŸ˜³</span> <!--ğŸ˜Œ-->
        <input type="text" id="answer" spellcheck="false" autocomplete="off" value="í˜¸ê¸°ì‹¬" size="8">
        <button id="quiz">ë§ì¶°ë´ !</button>
        <button id="random2">ğŸ² 2</button>
        <button id="random3">ğŸ² 3</button>
        <button id="random4">ğŸ² 4</button>
        <button id="reset">âŒ</button>
        <button id="show-info">â“</button>
    </div>
    <div id="ui-bottom">
        <div id="test"></div>
    </div>
    <div id="info" style="display: none;">
        <h3>í•œê¸€ ìëª¨ ì„ì–´ ë§ì¶”ê¸°</h3>
        <h4>ë†€ì´ ë°©ë²•</h4>
        <ul>
            <li>ğŸ˜³ / ğŸ˜Œ : ì •ë‹µ ë³´ê¸° / ìˆ¨ê¸°ê¸°</li>
            <li><input type="text" size="8"> : ì •ë‹µ ì§ì ‘ ì“°ê¸°</li>
            <li><button>ë§ì¶°ë´ !</button> : ìˆ¨ê¸¸ ì •ë‹µì„ ì§ì ‘ ì…ë ¥í•œ í›„ â€˜ë§ì¶°ë´!â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë³´ì„¸ìš”. ë‹¨ì–´ì˜ ìëª¨ê°€ ì„ì…ë‹ˆë‹¤.</li>
            <li><button>ğŸ² 2</button> <button>ğŸ² 3</button> <button>ğŸ² 4</button> : ë¯¸ë¦¬ ì…ë ¥í•´ ë‘” ë‘ ê¸€ì, ì„¸ ê¸€ì, ë„¤ ê¸€ì ë‹¨ì–´ ì¤‘ ë¬´ì‘ìœ„ë¡œ ë¬¸ì œê°€ ë‚˜ì˜µë‹ˆë‹¤.</li>
            <li><button>âŒ</button> : ë‹¤ì‹œ ì‹œì‘ (ë‹¤ ì§€ìš°ê¸°)</li>
            <li><button>â“</button> : ë†€ì´ ë°©ë²• ë‹¤ì‹œ ë³´ê¸°</li>
            <li>ì •ë‹µì„ ë§ì¶”ë©´ ê¸€ì ì£¼ë³€ì˜ ìƒ‰ì´ ë°”ë€Œê³  ìš°í•˜ë‹¨ì˜ ë§í¬ë¡œ ê·¸ ì˜ë¯¸ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            <li><a href="https://www.hanmiu.cc" target="_blank">í•œë¯¸ìœ ì¹˜ì›</a> ì–´ë¦°ì´ë“¤ì„ ìœ„í•´ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì¬ë¯¸ìˆê²Œ í™œìš©í•´ ì£¼ì„¸ìš” !</li>
        </ul>
        <div style="text-align: right; font-size: 0.8em; margin: 20px 0px 10px 0px;">ì°½ì‘: ë¯¸ë””ì–´ì•„í‹°ìŠ¤íŠ¸ ìµœìŠ¹ì¤€</div>
        <div style="text-align: right;">
            <img src="https://www.hanmiu.cc/images/logotype/hanmi_logotype.svg" height="25px">
        </div>
        <div style="text-align: right; padding-top: 10px; border-top: 1px solid gray;">
            <button id="close-info">ë†€ì´ ë°©ë²• ë‹«ê¸°</button>
        </div>
    </div>
</body>
<script>
    if(!localStorage.jamo_anagram_visited_count) {
        localStorage.jamo_anagram_visited_count = 1;
        document.querySelector('#info').style.display = 'block';
    }
    else {
        let visited_count = parseInt(localStorage.jamo_anagram_visited_count);
        visited_count += 1;
        if(visited_count <= 3) {
            document.querySelector('#info').style.display = 'block';
        }
        localStorage.jamo_anagram_visited_count = visited_count;
    }

    let el_showhide = document.querySelector('#showhide');

    function show_answer() {
        document.querySelector('#answer').style.color = 'rgba(0, 0, 0, 1.0)';
        el_showhide.innerHTML = 'ğŸ˜³';
        el_showhide.dataset.status = 'show';
    }

    function hide_answer() {
        document.querySelector('#answer').style.color = 'rgba(0, 0, 0, 0.0)';
        el_showhide.innerHTML = 'ğŸ˜Œ';
        el_showhide.dataset.status = 'hide';
    }

    show_answer();

    let params = new URLSearchParams(new URL(location.href).search);
    if(params.has('answer')) {
        hide_answer();
        document.querySelector('#answer').value = params.get('answer');
    }

    let jamo_size = 100;
    // á…¡á…¢á…£á…¤á…¥á…¦á…§á…¨á…©á…ªá…«á…¬á…­á…®á…¯á…°á…±á…²á…³á…´á…µ
    let type_v = 'á…¡á…¢á…£á…¤á…¥á…¦á…§á…¨á…µ'.split('');
    let type_h = 'á…©á…­á…®á…²á…³'.split('');
    let type_d = 'á…ªá…«á…¬á…¯á…°á…±á…´'.split('');

    function shuffle(array) {
        let n = array.length, t, i;
        while (n) {
            i = Math.random() * n-- | 0; // 0 â‰¤ i < n
            t = array[n];
            array[n] = array[i];
            array[i] = t;
        }
        return array;
    }

    let words2 = shuffle(`ê°€ë°©,ê°€ì„,ê°€ì¡±,ê°„ì‹,ê°ˆì¹˜,ê°ì˜¥,ê°ì,ê°ì •,ê°‘ì˜·,ê°•ë³€,ê°¯ë²Œ,ê±°ìš¸,ê±´ê°•,ê±´ë¬¼,ê²Œì„,ê²¨ìš¸,ê²°í˜¼,ê²½ì‚¬,ê²½ì°°,ê³„ê³¡,ê³„ì‚°,ê³„ì ˆ,ê³µê°„,ê³µê¸°,ê³µë£¡,ê³µë¶€,ê³µì—°,ê³µì›,ê³µì¥,ê³µì£¼,ê³µì§œ,ê³µì±…,ê³µí•™,ê³¼ì¼,ê³¼í•™,ê´€ì°°,ê´‘ê³ ,ê´‘ëŒ€,ê´´ë¬¼,êµí†µ,êµ¬ë¦„,êµ¬ì²­,êµ­ìˆ˜,êµ­ì–´,êµ´ëš,ê·¸ë¦¼,ê·¹ì¥,ê¸ˆì„±,ê¸°ë¶„,ê¸°ì¨,ê¸°ì—…,ê¸°ì¹¨,ê¹€ì¹˜,ê¹ƒí„¸,ê½ƒê²Œ,ê¿€ë²Œ,ë‚˜ë°©,ë‚™íƒ€,ë‚ ì”¨,ë‚ ì¹˜,ë‚¨ê·¹,ë‚¨í•´,ë…¸ë‘,ë…¸ì„,ë†€ì´,ë†êµ¬,ë†ì¥,ëˆˆë¬¼,ë‹¬ê±€,ë‹¬ë¹›,ë‹¹ê·¼,ë„ë‘‘,ë™êµ´,ë™ë¬¼,ë™ì „,ë™í•´,ë™í™”,ë“±ì‚°,ë”±ì§€,ë”¸ê¸°,ë–¡êµ­,ë¡œë´‡,ë§ˆë‹¹,ë§ˆë²•,ë§ˆìˆ ,ë§ˆì„,ë§ˆìŒ,ë§Œë‘,ë§Œí™”,ë§ë²Œ,ë§ê³ ,ëª¨ë¸,ëª¨ì–‘,ëª¨í—˜,ëª©ì„±,ëª©ìš•,ë¬´ìš©,ë¬´í•œ,ë¬¸ì–´,ë¬¸ì œ,ë¬¸í™”,ë¬¼ê±´,ë¯¸êµ­,ë¯¸ìˆ ,ë¯¿ìŒ,ë°”ë‹¤,ë°”ëŒ,ë°•ì‚¬,ë°•ì¥,ë°˜ë‹¬,ë°˜ì§€,ë°©ê·€,ë°©íŒ¨,ë°©í•™,ë°°ì›€,ë²„ì„¯,ë²Œë ˆ,ë³‘ì›,ë³´ë¬¼,ë³´ì„,ë³µì–´,ë¶ê·¹,ë¸”ë¡,ë¹„ë°€,ë¹Œë”©,ë¹¨ê°•,ë¹µì§‘,ì‚¬ê²©,ì‚¬ëŒ,ì‚¬ë‘,ì‚¬ìŠ´,ì‚¬ì‹¤,ì‚¬ì „,ì‚¬ì§„,ì‚¬íƒ•,ì‚°ë¶ˆ,ì‚°ì ,ì‚°ì±…,ì‚¼ì´Œ,ìƒì–´,ìƒ‰ê¹”,ìƒê°,ìƒëª…,ìƒì„ ,ìƒì¼,ì„œìš¸,ì„ ë¬¼,ì„¤ê³„,ì„¤ë‚ ,ì„¤ëª…,ì„¤íƒ•,ì„±ê³µ,ì„¸ìƒ,ì†Œê¸ˆ,ì†Œë§,ì†Œì›,ì†Œí’,ì†ë‹˜,ìˆ˜ë°•,ìˆ˜ì„±,ìˆ˜ì˜,ìˆ™ì œ,ìˆ«ì,ì‰¼í„°,ìŠ¬í””,ì‹œê°„,ì‹œê³¨,ì‹œì¥,ì‹ë¬¼,ì‹ì‚¬,ì‹ ë°œ,ì‹ ë¹„,ì‹ í™”,ì‹¤ë§,ì‹¤ìˆ˜,ì‹¤íŒ¨,ì‹¸ì›€,ì”¨ì•—,ì•„ì¹¨,ì•ˆê²½,ì•ˆì „,ì•½êµ­,ì–‘ë…,ì–´ë¥¸,ì–¸ì–´,ì–¼ìŒ,ì—„ë§ˆ,ì—‰ë§,ì—¬ë¦„,ì—¬ì™•,ì—¬í–‰,ì—­ì‚¬,ì—°êµ¬,ì—°ê·¹,ì—°ìŠµ,ì—°í•„,ì—´ë§¤,ì˜êµ­,ì˜ìƒ,ì˜ì–´,ì˜ì›…,ì˜í™”,ì˜ˆìˆ ,ì˜¥ìƒ,ì˜¨ë„,ì˜·ì¥,ì™•êµ­,ì™•ì,ì™¸ì‹,ìš”ì •,ìš©ê¸°,ìš©ì‚¬,ìš©ì•”,ìš°ë°•,ìš°ì‚°,ìš´ë™,ì€í•˜,ì€í–‰,ìŒì•…,ì´ë¶ˆ,ì¸ê°„,ì¸ë„,ì¸ì‚¬,ì¸í˜•,ì¼ê¸°,ì¼ë³¸,ì¼ì‚°,ì…ì²´,ìì—°,ì¥ë§ˆ,ì¥ë¯¸,ì¥í™”,ì €ë…,ì „ìŸ,ì „ì² ,ì ì‹¬,ì •ê¸€,ì •ì›,ì¢…ì´,ì£¼ë¬¸,ì¤‘êµ­,ì§€ì§„,ì§„í™”,ì§ˆì„œ,ì§¬ë½•,ì°¸ìƒˆ,ì±…ìƒ,ì±…ì¥,ì²­ì†Œ,ì´ˆë¡,ì´›ë¶ˆ,ì¶”ì„,ì¶•êµ¬,ì¶•ì œ,ì¹œêµ¬,ì¹¨ëŒ€,ì¹­ì°¬,ìº í”„,í¬ë¦¼,íƒêµ¬,íƒêµ¬,íƒì •,íƒí—˜,íƒœì–‘,íƒœí’,íƒ±í¬,í…íŠ¸,í† ì„±,í†µì¦,íŠ€ê¹€,íŠ¸ëŸ­,íŠ¸ë¦¼,íŒŒë‘,íŒ”ì°Œ,íŒ½ì´,í­ê·„,í¸ì§€,í‰í™”,í­ìš°,í­í’,í‘œë²”,í’€ì,í’ì„ ,í”¼ë§,í•˜ëŠ˜,í•™êµ,í•œê¸€,í•´ë³€,í•´ì ,í–‡ë¹›,í–‰ë³µ,í–‰ì„±,í—¬ë©§,í˜„ì¬,í˜¸ë°•,í™ìˆ˜,í™”ì‚°,í™”ì‚´,í™”ì„±,í™”ì¥,í™˜ê²½,í™©ì†Œ,íœ´ì‹,íë¦„,í¬ë§`.split(','));
    let words3 = shuffle(`ê°€ì•¼ê¸ˆ,ê°€ìë¯¸,ê°ˆë§¤ê¸°,ê°•ì•„ì§€,ê°œêµ¬ë¦¬,ê°œë‚˜ë¦¬,ê±°ë¬¸ê³ ,ê²½ì‚¬ë¡œ,ê²½ì°°ì„œ,ê³„ì‚°ê¸°,ê³ ë“±ì–´,ê³ ë¦´ë¼,ê³ ì–‘ì‹œ,ê³ ì–‘ì´,ê³ ì¸ëŒ,ê³µì£¼ë‹˜,êµ¬ê¸‰ì°¨,êµ¬ì¡°ëŒ€,êµ°ë§Œë‘,ê·¸ë¦¼ì,ê·¸ë¦¼ì±…,ê¸ˆë¶•ì–´,ê¸ˆìš”ì¼,ê¸°ì°¨ì—­,ê¹Œë§ˆê·€,ê¿ˆë‚˜ë¼,ë‚˜ë¬´ê¾¼,ë‚˜ë­‡ì,ë…¸ì„ ë„,ë†€ì´í„°,ëˆˆì‚¬ëŒ,ë‹¬íŒ½ì´,ëŒ€í†µë ¹,ëŒ€í”¼ì†Œ,ëŒ€í•™êµ,ëŒ€í•™ìƒ,ë„ê¹¨ë¹„,ë„ë§ˆë±€,ë„ë¯¸ë…¸,ë„ì„œê´€,ë„ì‹œë½,ë„í† ë¦¬,ë…ìˆ˜ë¦¬,ëŒê³ ë˜,ë™ë¬¼ì›,ë™í™”ì±…,ë‘êº¼ë¹„,ë‘˜ë ˆê¸¸,ë“œë˜ê³¤,ë•…ê±°ë¯¸,ë§ˆë²•ì‚¬,ë§ˆìŠ¤í¬,ë§ˆìš°ìŠ¤,ë§ì›ê²½,ë©”ëšœê¸°,ëª¨ë˜ì„±,ëª¨í—˜ê°€,ëª©ê±¸ì´,ëª©ìš”ì¼,ëª©ìš•íƒ•,ë¬´ì§€ê°œ,ë¬¼ë†€ì´,ë¯¸ìˆ ê´€,ë°•ë¬¼ê´€,ë°•ì‚¬ë‹˜,ë°˜ë”§ë¶ˆ,ë°±ë‘ì‚°,ë±ƒì‹œëŒ,ë³„ë˜¥ë³„,ë³„ìë¦¬,ë³´ê´€í•¨,ë³´ë¦„ë‹¬,ë¶€ë™ì‚°,ë¶ê·¹ê³°,ë¹„ë¹”ë°¥,ë¹„í–‰ê¸°,ì‚¬ë§ˆê·€,ìƒìƒë ¥,ìƒ‰ì—°í•„,ì„ ìƒë‹˜,ì„ í’ê¸°,ì„¤ê±°ì§€,ì„¤ê³„ë„,ì„¤ëª…ì„œ,ì†Œë‚˜ë¬´,ì†Œë°©ê´€,ì†Œë°©ì„œ,ì†Œë°©ì°¨,ì†Œí™”ê¸°,ì†ì¡ì´,ìˆ˜ì˜ì¥,ìˆ˜ì¡±ê´€,ìˆ˜ì¦ê¸°,ìŠ¹ê°•ê¸°,ìŠ¹ê°•ì¥,ì‹ë¬¼ì›,ì‹ ê¸°ë£¨,ì‹¤ë‚´í™”,ì‹¬ë¶€ë¦„,ì“°ë ˆê¸°,ì•„ë§ˆì¡´,ì•„íŒŒíŠ¸,ì•ˆì „ë ,ì•Œì‚¬íƒ•,ì• ë²Œë ˆ,ì–´ë¦°ì´,ì—°êµ¬ì‹¤,ì—°ì£¼íšŒ,ì˜í™”ê´€,ì˜ˆìˆ ê°€,ì˜¤ëšê¸°,ì˜¤ë¡œë¼,ì˜¤ì§•ì–´,ì˜¥ìˆ˜ìˆ˜,ì˜¬ë¹¼ë¹„,ì™•ìë‹˜,ì™¸ê³„ì¸,ìš°ì£¼ì„ ,ìš°ì²´êµ­,ìš´ë™ì¥,ìš´ë™í™”,ìš´ì „ëŒ€,ì›ìˆ­ì´,ì›”ìš”ì¼,ìœ ë‹ˆì½˜,ìœ ì¹˜ì›,ìœ íŠœë¸Œ,ì€í•˜ìˆ˜,ìŒì‹ì ,ìë™ì°¨,ìì „ê±°,ì ìë¦¬,ì¥ë‚œê°,ì¥ë§ˆì² ,ì „ê°œë„,ì •ê±°ì¥,ì¢…ë‹¬ìƒˆ,ì£¼ì‚¬ìœ„,ì¤„ë„˜ê¸°,ì¤‘í•™êµ,ì§€êµ¬ë³¸,ì§€ë ì´,ì§€ìš°ê°œ,ì§€í•˜ì² ,ì§„ë‹¬ë˜,ì°¨ë¦¼í‘œ,ì°¸ë‚˜ë¬´,ì²œë¬¸ëŒ€,ì¶•êµ¬ê³µ,ì¹´ë©”ë¼,ì»´í“¨í„°,ì½”ë¼ë¦¬,ì½”ë¿”ì†Œ,í‚¤ë³´ë“œ,íƒí—˜ëŒ€,íƒ•ìˆ˜ìœ¡,íƒœì–‘ê³„,íƒœí‰ì–‘,íŒ¥ë¹™ìˆ˜,í¸ì˜ì ,í”¼ì•„ë…¸,í•œë¼ì‚°,í• ë¨¸ë‹ˆ,í•´ì ì„ ,í•´íŒŒë¦¬,í˜„ë¯¸ê²½,í˜¸ê¸°ì‹¬,í™”ì¥ì‹¤,íšŒì‚¬ì›,íœ˜íŒŒëŒ`.split(','));
    let words4 = shuffle(`ê°€ì¡±ì—¬í–‰,ê³ ë“±í•™êµ,ê³ ë“±í•™ìƒ,ê³ ë˜ìƒì–´,ê³ ìŠ´ë„ì¹˜,ê³ ì¶”ëƒ‰ì´,ê·€ëšœë¼ë¯¸,ê¹€ì¹˜ì°Œê°œ,ë‚˜ë¬´ëŠ˜ë³´,ë†€ì´ê³µì›,ëŠí‹°ë‚˜ë¬´,ëŒ€í•œë¯¼êµ­,ëœì¥ì°Œê°œ,ë”±ì •ë²Œë ˆ,ëª¨ë˜ì‹œê³„,ë¬´ë‹¹ë²Œë ˆ,ë­‰ê²Œêµ¬ë¦„,ë¯¸ë„ëŸ¼í‹€,ë¯¸ì„¸ë¨¼ì§€,ë°€ì§šëª¨ì,ë°”ë‹¤í‘œë²”,ë°”ì´ì˜¬ë¦°,ë°±ê³¼ì‚¬ì „,ë°±ìƒì•„ë¦¬,ë°±ì„¤ê³µì£¼,ë¶ˆê°€ì‚¬ë¦¬,ë¶ˆê½ƒë†€ì´,ë¹„ë°€ê¸°ì§€,ë¹„ë°€ë²ˆí˜¸,ì‚¬ê³¼ë‚˜ë¬´,ì‚¬ìŠ´ë²Œë ˆ,ì†ëª©ì‹œê³„,ì†¡ì´ë²„ì„¯,ìˆ˜ë„ê¼­ì§€,ìˆ˜ìˆ˜ê»˜ë¼,ìŠ¤ë§ˆíŠ¸í°,ìŠ¤ì¼€ì´íŠ¸,ìŠ¤íŒŒê²Œí‹°,ì“°ë ˆê¸°í†µ,ì•„ë¦„ë“œë¦¬,ì•ˆì „ìš´ì „,ì•¼ìƒë™ë¬¼,ì–´ë¦°ì´ë‚ ,ì–´ë¦°ì´ì§‘,ì—‰ë§ì§„ì°½,ì˜ˆë°©ì£¼ì‚¬,ì˜¤ì•„ì‹œìŠ¤,ì€ê·¼ìŠ¬ì©,ì¸ê³µì§€ëŠ¥,ì¸ì–´ê³µì£¼,ì¼ê¸°ì˜ˆë³´,ìì‘ë‚˜ë¬´,ì¢…ì´ì ‘ê¸°,ì´ˆë“±í•™êµ,ì´ˆë“±í•™ìƒ,ì¹´ë©œë ˆì˜¨,í• ì•„ë²„ì§€,í•´ë°”ë¼ê¸°,í–¥ìœ ê³ ë˜,í—ˆìˆ˜ì•„ë¹„,í—ë ˆë²Œë–¡,í˜¸ë‘ë‚˜ë¹„,í”ë“¤ì˜ì`.split(','));

    function quiz_(answer) {
        clear();
        let chars = answer.split('');
        let jamos = [];
        for(let ch of chars) {
            let decomposed = Array.from(ch.normalize('NFD'));
            jamos.push(...decomposed);
        }
        let shuffled = shuffle(jamos);
        let x = jamo_size, y = 200;
        for(let jm of shuffled) {
            let el_jamo = document.createElement('div');
            el_jamo.dataset.jamo = jm;
            el_jamo.classList.add('jamo');
            el_jamo.innerText = jm;
            document.querySelector('#stage').appendChild(el_jamo);
            el_jamo.style.transform = `translate(${x}px, ${y}px)`;
            el_jamo.dataset.x = x;
            el_jamo.dataset.y = y;
            if(x + jamo_size * 1.5 > window.innerWidth) {
                y += jamo_size;
                x = jamo_size;
            }
            else {
                x += jamo_size;
            }
        }

        hide_answer();
    }

    function quiz(answer) {
        clear();
        let chars = mix_jamo(answer);
        let x = jamo_size * 1.5, y = 250;
        for(let ch of chars) {
            let [cho, jung, jong] = ch; 
            let el_jung = document.createElement('div');
            el_jung.dataset.jamo = jung;
            el_jung.classList.add('jamo');
            el_jung.innerText = jung;
            document.querySelector('#stage').appendChild(el_jung);
            el_jung.style.transform = `translate(${x}px, ${y}px)`;
            el_jung.dataset.x = x;
            el_jung.dataset.y = y;

            let el_cho = document.createElement('div');
            el_cho.dataset.jamo = cho;
            el_cho.classList.add('jamo');
            el_cho.innerText = cho;
            document.querySelector('#stage').appendChild(el_cho);

            let el_jong;
            if(jong !== '') {
                el_jong = document.createElement('div');
                el_jong.dataset.jamo = jong;
                el_jong.classList.add('jamo');
                el_jong.innerText = jong;
                document.querySelector('#stage').appendChild(el_jong);
            }

            let [dx, dy] = [0, 0];
            if(type_v.includes(jung)) {
                dx = jamo_size * 0.75;
                el_cho.style.transform = `translate(${x - dx}px, ${y}px)`;
                el_cho.dataset.x = x - dx;
                el_cho.dataset.y = y;
                if(el_jong) {
                    dx = jamo_size * 0.25;
                    dy = jamo_size * 0.9;
                    el_jong.style.transform = `translate(${x - dx}px, ${y + dy}px)`;
                    el_jong.dataset.x = x - dx;
                    el_jong.dataset.y = y + dy;
                }               
            }
            else if(type_d.includes(jung)) {
                dx = jamo_size * 0.25;
                dy = jamo_size * 0.5;
                el_cho.style.transform = `translate(${x - dx}px, ${y - dy}px)`;
                el_cho.dataset.x = x - dx;
                el_cho.dataset.y = y - dx; 
                if(el_jong) {
                    dy = jamo_size * 0.8;
                    el_jong.style.transform = `translate(${x}px, ${y + dy}px)`;
                    el_jong.dataset.x = x;
                    el_jong.dataset.y = y + dy;
                } 
            }
            else if(type_h.includes(jung)) {
                dy = jamo_size * 0.7;
                el_cho.style.transform = `translate(${x}px, ${y - dy}px)`;
                el_cho.dataset.x = x;
                el_cho.dataset.y = y - dy;
                if(el_jong) {
                    dy = jamo_size * 0.75;
                    el_jong.style.transform = `translate(${x}px, ${y + dy}px)`;
                    el_jong.dataset.x = x;
                    el_jong.dataset.y = y + dy;
                } 
            }

            if(x + jamo_size * 2 > window.innerWidth) {
                y += jamo_size * 2;
                x = jamo_size * 1.5;
            }
            else {
                x += jamo_size * 1.75;
            }
        }

        hide_answer();
    }

    document.querySelector('#quiz').addEventListener('click', () => {
        let el_answer = document.querySelector('#answer');
        quiz(el_answer.value);
    });

    document.querySelector('#random2').addEventListener('click', () => {
        let word = words2.pop();
        words2.unshift(word);
        quiz(word);
        document.querySelector('#answer').value = word;
    });

    document.querySelector('#random3').addEventListener('click', () => {
        let word = words3.pop();
        words3.unshift(word);
        quiz(word);
        document.querySelector('#answer').value = word;
    });

    document.querySelector('#random4').addEventListener('click', () => {
        let word = words4.pop();
        words4.unshift(word);
        quiz(word);
        document.querySelector('#answer').value = word;
    });

    function clear() {
        let stage = document.querySelector('#stage');
        stage.innerHTML = '';
        document.querySelector('#test').innerHTML = '';
        document.querySelector('#info').style.display = 'none';
    }

    document.querySelector('#reset').addEventListener('click', () => {
        document.querySelector('#answer').value = '';
        clear();
    });

    el_showhide.addEventListener('click', (event) => {
        if(el_showhide.dataset.status === 'show') {
            hide_answer();
        } else {
            show_answer();
        }
    });
    
    let selectedJamo = null;
    let offsetX = 0, offsetY = 0;

    function handleStart(event) {
        let target = event.target;
        if(target.classList.contains('jamo')) {
            selectedJamo = target;
            let rect = selectedJamo.getBoundingClientRect();

            if (event.type === 'mousedown') {
                offsetX = event.pageX - rect.left;
                offsetY = event.pageY - rect.top;
            } else if (event.type === 'touchstart') {
                offsetX = event.touches[0].pageX- rect.left;
                offsetY = event.touches[0].pageY - rect.top;
                
            }
            selectedJamo.style['-webkit-text-stroke'] = '3px blue';
            selectedJamo.style.color = 'blue';
        }
    }

    function handleMove(event) {
        if(selectedJamo) {
            let x, y;
            if (event.type === 'mousemove') {
                x = event.pageX - offsetX;
                y = event.pageY - offsetY;
            } else if (event.type === 'touchmove') {
                // event.preventDefault();
                x = event.touches[0].pageX - offsetX;
                y = event.touches[0].pageY - offsetY;
            }
            selectedJamo.style.transform = `translate(${x}px, ${y}px)`;
            selectedJamo.dataset.x = x;
            selectedJamo.dataset.y = y;
            selectedJamo.style['-webkit-text-stroke'] = '3px blue';
            selectedJamo.style.color = 'blue';
            compose();
        }
        else {
            if(event.target.classList.contains('jamo')) {
                event.target.style['-webkit-text-stroke'] = '3px blue';
                event.target.style.color = 'blue';
            }
        }
    }

    document.addEventListener('mouseout', (event) => {
        if(event.target.classList.contains('jamo')) {
            event.target.style['-webkit-text-stroke'] = '';
            event.target.style.color = '';
        }
    });

    function handleEnd(event) {
        if(selectedJamo) {
            selectedJamo.style['-webkit-text-stroke'] = '';
            selectedJamo.style.color = '';
            is_correct();
        }
        selectedJamo = null;
    }

    function resize() {
        // ê°€ë¡œê°€ ì„¸ë¡œë³´ë‹¤ ì‘ìœ¼ë©´ ê¸°ì¡´ì˜ style ruleì—ì„œ classê°€ jamo ì¸ê²ƒì˜ font-sizeë¥¼ 50pxë¡œ ì„¤ì •
        if(window.innerWidth < window.innerHeight) {
            jamo_size = 50;
        }  
        else {
            jamo_size = 100;
        }
        let styleSheet = document.styleSheets[0];
        let cssRules = Array.from(styleSheet.cssRules || styleSheet.rules);
        let rule = cssRules.filter(x => x.selectorText == '.jamo')[0];
        rule.style.fontSize = `${jamo_size}px`;
    }

    document.querySelector('#close-info').addEventListener('click', () => {
        document.querySelector('#info').style.display = 'none';
    });

    document.querySelector('#show-info').addEventListener('click', () => {
        document.querySelector('#info').style.display = 'block';
    });

    window.addEventListener('resize', (event) => {
        setTimeout(() => {
            resize();
        }, 100);
    });

    window.addEventListener("orientationchange", (event) => {
        setTimeout(() => {
            resize();
        }, 100);
    });

    document.addEventListener('mousedown', handleStart);
    document.addEventListener('touchstart', handleStart);

    document.addEventListener('mousemove', handleMove);
    document.addEventListener('touchmove', handleMove);

    document.addEventListener('mouseup', handleEnd);
    document.addEventListener('touchend', handleEnd);

    document.addEventListener('contextmenu', (event) => {
        event.preventDefault();
        //event.stopPropagation();
    });

    document.addEventListener('dragstart', (event) => {
        event.preventDefault();
    });

    function getJamoType(char) {
        if(!char) return - 1;
        const codePoint = char.codePointAt(0);

        // ì´ˆì„± (Leading consonants): U+1100 â€“ U+1112 (19ì)
        // á„€á„á„‚á„ƒá„„á„…á„†á„‡á„ˆá„‰á„Šá„‹á„Œá„á„á„á„á„‘á„’
        if (codePoint >= 0x1100 && codePoint <= 0x1112) {
            return 0;
        }

        // ì¤‘ì„± (Vowels): U+1161 â€“ U+1175 (21ì)
        // á…¡á…¢á…£á…¤á…¥á…¦á…§á…¨á…©á…ªá…«á…¬á…­á…®á…¯á…°á…±á…²á…³á…´á…µ
        if (codePoint >= 0x1161 && codePoint <= 0x1175) {
            return 1;
        }

        // ì¢…ì„± (Trailing consonants): U+11A8 â€“ U+11C2 (27ì), U+11A7 (ì¢…ì„±ì´ ì—†ëŠ” ê²½ìš°)
        // á†¨á†©á†ªá†«á†¬á†­á†®á†¯á†°á†±á†²á†³á†´á†µá†¶á†·á†¸á†¹á†ºá†»á†¼á†½á†¾á†¿á‡€á‡á‡‚
        if ((codePoint >= 0x11A8 && codePoint <= 0x11C2) || codePoint === 0x11A7) {
            return 2;
        }

        // const syllable = 0xAC00 + (choIndex * 21 * 28) + (jungIndex * 28) + jongIndex;

        return -1;
    }

    function compose() {
        el_chars = [];

        let el_jamos = Array.from(document.querySelectorAll('.jamo')).sort((a, b) => {
            let rect_a = a.getBoundingClientRect();
            let rect_b = b.getBoundingClientRect();
            return rect_a.left - rect_b.left;
        });

        let print = '';

        for(let el_jamo of el_jamos) {
            let jamo = el_jamo.dataset.jamo;
            let jamo_type = getJamoType(jamo);
            let el_rect = el_jamo.getBoundingClientRect();
            let x = el_rect.left + el_rect.width / 2;
            let y = el_rect.top + el_rect.height / 2;
            let min_d = Number.MAX_VALUE;
            let el_cho = null;
            if(jamo_type === 1) { // ì¤‘ì„± ëª¨ìŒ
                for(let other_jamo of el_jamos) {
                    if(getJamoType(other_jamo.dataset.jamo) === 1) continue;
                    let other_rect = other_jamo.getBoundingClientRect();
                    let other_x = other_rect.left + other_rect.width / 2;
                    let other_y = other_rect.top + other_rect.height / 2; 
                    if(el_jamo !== other_jamo) {
                        let dx = other_x - x;
                        let dy = other_y - y;
                        let d = Math.sqrt(dx * dx + dy * dy);
                        if(d > jamo_size * 1.25) continue;
                        if(type_v.includes(jamo)) { // ã… type
                            if(dx < 0 && (other_y > y - jamo_size/2 && other_y < y + jamo_size/2)) {
                                if(d < min_d) {
                                    min_d = d;
                                    el_cho = other_jamo;
                                }
                            }
                        } else if(type_h.includes(jamo) || type_d.includes(jamo)) { // ã…— type ë˜ëŠ” á…ª type
                            if(dy < 0) {
                                if(d < min_d) {
                                    min_d = d;
                                    el_cho = other_jamo;
                                }
                            }
                        }        
                    }
                }

                if(el_cho) {
                    el_chars.push({
                        cho: el_cho,
                        jung: el_jamo,
                        jong: null,
                    });
                }
                window.el_chars = el_chars;
            }
        }

        let common_cho = ['á„€', 'á„', 'á„‚', 'á„ƒ', 'á„…', 'á„†', 'á„‡', 'á„‰', 'á„Š', 'á„‹', 'á„Œ', 'á„', 'á„', 'á„', 'á„‘', 'á„’'];
        let common_jong = ['á†¨', 'á†©', 'á†«', 'á†®', 'á†¯', 'á†·', 'á†¸', 'á†º', 'á†»', 'á†¼', 'á†½', 'á†¾', 'á†¿', 'á‡€', 'á‡', 'á‡‚'];

        for(let el_char of el_chars) {
            let rect = el_char.jung.getBoundingClientRect();
            let left = el_char.cho.getBoundingClientRect().left - jamo_size/2;
            let right = el_char.jung.getBoundingClientRect().right +  jamo_size/2;
            let candidates = [];
            for(let other_jamo of el_jamos) {
                if(getJamoType(other_jamo.dataset.jamo) === 1) continue;
                let other_rect = other_jamo.getBoundingClientRect();
                let other_x = other_rect.left + other_rect.width / 2;
                let other_y = other_rect.top + other_rect.height / 2;
                
                let dx = other_x - rect.left + rect.width / 2;
                let dy = other_y - rect.top + rect.height / 2;
                let d = Math.sqrt(dx * dx + dy * dy);
                
                if(other_x > left && other_x < right && Math.abs(dy) < jamo_size * 1.5) {
                    candidates.push(other_jamo);    
                }
            }
            if(candidates.length > 0) {
                candidates.sort((a, b) => b.getBoundingClientRect().top - a.getBoundingClientRect().top);
                if(el_char.cho !== candidates[0]) {
                    el_char.jong = candidates[0];
                }
            }

            let cho = el_char.cho.dataset.jamo;
            let jung = el_char.jung.dataset.jamo;
            let jong = el_char.jong ? el_char.jong.dataset.jamo : '';
            if(getJamoType(el_char.cho.dataset.jamo) === 2) { // ì´ˆì„± ìë¦¬ì— ëª¨ì–‘ì´ ê°™ì€ ì¢…ì„±ì´ ì˜¤ë©´
                let idx = common_jong.indexOf(el_char.cho.dataset.jamo);
                cho = common_cho[idx];
            }

            if(el_char.jong) {
                if(getJamoType(el_char.jong.dataset.jamo) === 0) { // ì¢…ì„± ìë¦¬ì— ëª¨ì–‘ì´ ê°™ì€ ì´ˆì„±ì´ ì˜¤ë©´
                    let idx = common_cho.indexOf(el_char.jong.dataset.jamo);
                    jong = common_jong[idx];
                }
            }
            
            if(!cho) cho = '';
            if(!jung) jung = '';
            if(!jong) jong = '';

            print += cho + jung + jong;
        }

        document.querySelector('#test').textContent = print;
    }

    function is_correct() {
        let ans = document.querySelector('#answer').value;
        let answer = document.querySelector('#answer').value.normalize('NFD');
        let test = document.querySelector('#test').textContent.normalize('NFD');
        if(answer == test) {
            for(let el_jamo of document.querySelectorAll('.jamo')) {
                let hue = Math.random() * 360;
                el_jamo.style.textShadow = `0px 0px ${jamo_size/4}px hsl(${hue}, 100%, 70%)`;
            }
            show_answer();
            document.querySelector('#test').innerHTML = `<a href="https://ko.wikipedia.org/wiki/${ans}" target="_blank">${ans}</a>`;
        }
        else {
            for(let el_jamo of document.querySelectorAll('.jamo')) {
                el_jamo.style.textShadow = '';
            }
        }
    }

    function mix_jamo(str) {
        let chars = [];
        let result = [];
        for(let ch of str) {
            let decomposed = Array.from(ch.normalize('NFD'));
            if(decomposed.length < 3) {
                decomposed.push('');
            }
            chars.push(decomposed);
        }
        let shuffled = shuffle(chars);
        // flatten shuffled
        shuffled = shuffled.reduce((a, b) => a.concat(b), []);
        // 3ê°œì”© ëŠì–´ê°€ë‹ˆê¹Œ 3ìœ¼ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ê°€ 1ì¸ ê²ƒë“¤ì€ ì¤‘ì„± ëª¨ìŒì´ ì•„ë‹Œ ê²ƒë“¤
        let jaum_indices = shuffled.map((x,i) => i).filter((x,i) => i%3 !== 1);
        //console.log(jaum_indices);
        for(let i = 0; i < jaum_indices.length - 1; i++) {
            let candidates = jaum_indices.slice(i+1, jaum_indices.length);
            if(getJamoType(shuffled[jaum_indices[i]]) === 0) { // ì´ˆì„±
                candidates = candidates.filter(x => shuffled[x] !== '');
            }
            if(candidates.length === 0) continue;
            let temp_jamo_idx = jaum_indices[i];
            let idx = Math.floor(Math.random() * candidates.length);
            let switch_idx = jaum_indices.indexOf(candidates[idx]);
            jaum_indices[i] = jaum_indices[switch_idx];
            jaum_indices[switch_idx] = temp_jamo_idx;
            //console.log(i, jaum_indices);
        }
        for(let i = 0; i < jaum_indices.length/2; i++) {
            let cho = shuffled[jaum_indices[2 * i]];
            let jung = shuffled[3 * i + 1];
            let jong = shuffled[jaum_indices[2 * i + 1]];
            if(cho === '') {
                cho = jong;
                jong = '';
                if(cho === '') { // ë§ˆì§€ë§‰ ê¸€ìì— ì¤‘ì„±ë§Œ ìˆëŠ” í™•ë¥  ë‚®ì€ ê²½ìš°
                    for(let res of result) {
                        if(res[2] !== '') {
                            cho = res[2];
                            res[2] = '';
                            break;
                        }
                    }
                }
            }
            result.push([cho, jung, jong]);
        }
        return result;
    }

    resize();
</script>