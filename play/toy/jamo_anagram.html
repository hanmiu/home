<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1">
<title>í•œê¸€ ìëª¨ ì„ì–´ ë§ì¶”ê¸°</title>
<style>
    body {
        overflow: hidden;
        touch-action: none;
        user-select: none;
    }

    #showhide {
        display: inline-block;
        font-size: 1.2em;
        transform: translateY(0.1em);
        cursor: pointer;
        margin-right: 0.1em;
    }

    #showhide:hover {
        text-shadow: 0px 0px 10px cyan;
    }

    #answer {
        color: rgba(0, 0, 0, 1.0);
    }

    #stage {
        position: absolute;
        left: 0px;
        top: 0px;
    }

    .jamo {
        position: absolute;
        width: 10px;
        height: 10px;
        font-size: 100px;
        font-family: sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        /* border: 1px solid rgba(0, 0, 0, 0.25); */
        user-select: none;
        cursor: pointer;
        transition: text-shadow 0.5s;
    }

    /* .jamo:hover {
        -webkit-text-stroke: 3px blue;
        color: blue;
    } */

    #ui-top {
        position: absolute;
        left: 20px;
        top: 20px;
        line-height: 2em;
    }

    #ui-bottom {
        position: absolute;
        right: 20px;
        bottom: 20px;
        text-align: right;
    }

    #test {
        font-family: sans-serif;
        text-align: right;
    }

    #test > a:visited {
        color: LinkText;
    }
</style>
<body>
    <div id="stage">
        <!--<div class="jamo" style="left: 200px; top: 300px">ã…</div>-->
    </div>
    <div id="ui-top">
        <span id="showhide">ğŸ˜³</span> <!--ğŸ˜Œ-->
        <input type="text" id="answer" spellcheck="false" autocomplete="off" value="í•œë¯¸" size="8">
        <button id="quiz">ë§ì¶°ë´â—ï¸</button>
        <button id="random2">ğŸ² 2</button>
        <button id="random3">ğŸ² 3</button>
        <button id="random4">ğŸ² 4</button>
        <button id="reset">âŒ</button>
    </div>
    <div id="ui-bottom">
        <div id="test"></div>
    </div>
</body>
<script>
    let el_showhide = document.querySelector('#showhide');

    function show_answer() {
        document.querySelector('#answer').style.color = 'rgba(0, 0, 0, 1.0)';
        el_showhide.innerHTML = 'ğŸ˜³';
        el_showhide.dataset.status = 'show';
    }

    function hide_answer() {
        document.querySelector('#answer').style.color = 'rgba(0, 0, 0, 0.0)';
        el_showhide.innerHTML = 'ğŸ˜Œ';
        el_showhide.dataset.status = 'hide';
    }

    show_answer();

    let params = new URLSearchParams(new URL(location.href).search);
    if(params.has('answer')) {
        hide_answer();
        document.querySelector('#answer').value = params.get('answer');
    }
    let jamo_size = 100;

    function shuffle(array) {
        let n = array.length, t, i;
        while (n) {
            i = Math.random() * n-- | 0; // 0 â‰¤ i < n
            t = array[n];
            array[n] = array[i];
            array[i] = t;
        }
        return array;
    }

    let words2 = shuffle(`ì‚¬ì‹¤,ì¹œêµ¬,í•™êµ,ìƒì„ ,ê°€ì¡±,ë‚˜ë¬´,ë™ë¬¼,í•˜ëŠ˜,ë°”ë‹¤,ê³„ì ˆ,ì‚¬ë‘,ê¸°ì¨,ìŠ¬í””,ì±…ìƒ,ë¬¸ì œ,ë³´ë¬¼,ìš©ê¸°,ì‹ í™”,ë™í™”,ìš´ë™,ì¶•êµ¬,ìŒì•…,ë¬´ìš©,ì˜í™”,ë¯¸ìˆ ,ì‹œì¥,ê³¼ì¼,ê°ì,ìƒì¼,ì‚°ì±…,ì—¬í–‰,ì¶•ì œ,ë¬¸í™”,ì¸ì‚¬,ìš©ì‚¬,ëª¨í—˜,íƒí—˜,íƒêµ¬,ë¬¸ì œ,ë¬´í•œ,ê³µê°„,ì‹œê°„,ìƒëª…,ì‹ ë¹„,ê´€ì°°,ì§ˆì„œ,íë¦„,ëª¨ì–‘,ì˜ì›…,í•´ì ,ìš”ì •,ê´´ë¬¼,ê·¸ë¦¼,í¬ë§,ì†Œì›,ë¹„ë°€,ì˜·ì¥,ê±°ìš¸,ë°˜ì§€,íŒ”ì°Œ,ë³´ì„,ë§ˆìŒ,ê¸°ë¶„,ë¬¼ê±´,ì˜ˆìˆ ,ì‚¬ì§„,ë¹µì§‘,ì•„ì¹¨,ì ì‹¬,ì €ë…,ìì—°,ì‹ë¬¼,ê³µì›,ìˆ«ì,ê³¼í•™,ì–¸ì–´,í¸ì§€,ì„ ë¬¼,íœ´ì‹,ì‰¼í„°,ìº í”„,í…íŠ¸,ì‹œê³¨,ê°•ë³€,í•´ë³€,ì…ì²´,ë™êµ´,ì˜¥ìƒ,ì‹œê³¨,í˜„ì¬,ì¼ê¸°,ë§Œí™”,ì˜ìƒ,ì—°ê·¹,ê·¹ì¥,ê³µì—°,ëª¨ë¸,ë¡œë´‡,íŠ¸ëŸ­,í‘œë²”,ë¬¸ì–´,ì°¸ìƒˆ,ì‚¬ìŠ´,í’ì„ ,ì¶•êµ¬,ë†êµ¬,íƒêµ¬,ìˆ˜ì˜,ì±…ìƒ,ì¹¨ëŒ€,ì±…ì¥,ë°•ì¥,í™©ì†Œ,ë²Œë ˆ,ë†€ì´,ê³µë¶€,ìˆ™ì œ,í–‰ì„±,íƒœì–‘,ëª©ì„±,í™”ì„±,ê¸ˆì„±,ìˆ˜ì„±,í† ì„±,êµ¬ë¦„,ë°”ëŒ,ì—´ë§¤,ì”¨ì•—,ê±´ë¬¼,ì‹ë¬¼,ë¹¨ê°•,ë…¸ë‘,ì´ˆë¡,íŒŒë‘,ì •ê¸€,í¬ë¦¼,ë§ˆë²•,ë§ˆìˆ ,ì§„í™”,ëˆˆë¬¼,í­í’,íƒœí’,ì™•ì,ê³µì£¼,ì—¬ì™•,ì™•êµ­,ê´‘ëŒ€,ë§ê³ ,ë‹¹ê·¼,ìˆ˜ë°•,ë”¸ê¸°,ì‹ì‚¬,ë‹¬ê±€,ì—¬ë¦„,ê²¨ìš¸,ê°€ì„,ê³„ì ˆ,í–‡ë¹›,ë‹¬ë¹›,í’€ì,ë…¸ì„,íƒì •,í™”ì‚°,ì–´ë¥¸,ì‚¼ì´Œ,ì—„ë§ˆ,ê³µë£¡,ë‚˜ë°©,ë²„ì„¯,ì€í•˜,ë™í•´,ë‚¨í•´,ë‚¨ê·¹,ë¶ê·¹,ìš©ì•”,ì–¼ìŒ,ë‚ ì”¨,í™ìˆ˜,í­ìš°,ìš°ë°•,í˜¸ë°•,ìƒì–´,ì™¸ì‹,ë¹„ë°€,ì˜·ì¥,ë°©í•™,íŠ€ê¹€,ì†Œê¸ˆ,ì„¤íƒ•,ë™ì „,ì¶”ì„,ì„¤ë‚ ,ì„œìš¸,ë–¡êµ­,ë³‘ì›,ì•½êµ­,ì¥ë¯¸,ë‚™íƒ€,í­ê·„,ì¹¨ëŒ€,ê³„ê³¡,ë°©íŒ¨,ê°‘ì˜·,í—¬ë©§,ê³µê¸°,ì˜¨ë„,ì‹¤ë§,ê¸°ì¨,ìŠ¬í””,í–‰ë³µ,ê°¯ë²Œ,ë„ë‘‘,ê°ì˜¥,ê²½ì°°,ì¼ë³¸,ì¤‘êµ­,ë¯¸êµ­,ì˜êµ­,ì¸ë„,í™”ì¥,ì¥í™”,ê³µì¥,ì‚¬ëŒ,ì‚¬ë‘,ë°˜ë‹¬,ì†ë‹˜,ë§ˆì„,ëª©ìš•,ê²Œì„,ì‹¤ìˆ˜,ë§Œë‘,êµ­ì–´,ì˜ì–´,ì¹­ì°¬,ìƒ‰ê¹”,ìƒê°,ì„¸ìƒ,ë°°ì›€,ì‚¬ì „,ê°ì •,ê¹ƒí„¸,ì¸ê°„,ì—­ì‚¬,íŠ¸ë¦¼,ë°©ê·€,ì—‰ë§,ì²­ì†Œ,í™˜ê²½,ì—¬í–‰,ê°„ì‹,ì†Œí’,ì£¼ë¬¸,ë†ì¥,ì¸í˜•,ë“±ì‚°,ì •ì›,í•œê¸€,ì„±ê³µ,ì‹¤íŒ¨,ì „ìŸ,í‰í™”,ê°€ë°©,ì—°í•„`.split(','));
    let words3 = shuffle(`í˜¸ê¸°ì‹¬,ê·¸ë¦¼ì,ì€í•˜ìˆ˜,íƒœì–‘ê³„,í•œë¼ì‚°,ë°±ë‘ì‚°,ì£¼ì‚¬ìœ„,ë¹„í–‰ê¸°,ë„ì„œê´€,ìˆ˜ì¡±ê´€,ë°•ë¬¼ê´€,ì²œë¬¸ëŒ€,ìš°ì£¼ì„ ,ë™ë¬¼ì›,ë¬´ì§€ê°œ,ëª©ê±¸ì´,ë§ˆë²•ì‚¬,í•´ì ì„ ,ëª¨í—˜ê°€,ë¯¸ìˆ ê´€,ì˜í™”ê´€,ì‹ ê¸°ë£¨,ì™•ìë‹˜,ê³µì£¼ë‹˜,ë„ê¹¨ë¹„,ê¿ˆë‚˜ë¼,ê°•ì•„ì§€,ê³ ì–‘ì´,í¸ì˜ì ,ê¸°ì°¨ì—­,ì¤‘í•™êµ,ëŒ€í•™êµ,ëŒ€í•™ìƒ,ìˆ˜ì˜ì¥,ê²½ì°°ì„œ,ì†Œë°©ì„œ,ì†Œë°©ê´€,ëŒ€í†µë ¹,ë¬¼ë†€ì´,ì—°ì£¼íšŒ,ì‹ë¬¼ì›,ë°•ë¬¼ê´€,ë„ì„œê´€,ê¸ˆë¶•ì–´,ëª¨ë˜ì„±,ëˆˆì‚¬ëŒ,ìœ ì¹˜ì›,ì–´ë¦°ì´,ì„ ìƒë‹˜,í• ë¨¸ë‹ˆ,ë‹¬íŒ½ì´,ì‚¬ë§ˆê·€,ì˜¬ë¹¼ë¹„,ë…ìˆ˜ë¦¬,ê¹Œë§ˆê·€,ë¶ê·¹ê³°,ë‚˜ë¬´ê¾¼,ì¢…ë‹¬ìƒˆ,ì°¸ë‚˜ë¬´,ì†Œë‚˜ë¬´,ë©”ëšœê¸°,ê°œë‚˜ë¦¬,ì§„ë‹¬ë˜,ë‚˜ë­‡ì,ë†€ì´í„°,ì ìë¦¬,ì˜¤ì§•ì–´,ì˜¥ìˆ˜ìˆ˜,íšŒì‚¬ì›,ë§ì›ê²½,í˜„ë¯¸ê²½,ì½”ë¿”ì†Œ,ì½”ë¼ë¦¬,ì›ìˆ­ì´,ì•ˆì „ë ,ìœ ë‹ˆì½˜,ê°ˆë§¤ê¸°,ë„ë§ˆë±€,ë“œë˜ê³¤,ë°˜ë”§ë¶ˆ,ë³„ë˜¥ë³„,ìˆ˜ì¦ê¸°,ì›”ìš”ì¼,ê¸ˆìš”ì¼,ëª©ìš”ì¼,í™”ì¥ì‹¤,ë³´ë¦„ë‹¬,íŒ¥ë¹™ìˆ˜,ì‹ ê¸°ë£¨,ì¹´ë©”ë¼,ê·¸ë¦¼ì±…,ê·¸ë¦¼ì,ìš´ë™í™”,ìš´ë™ì¥,ì»´í“¨í„°,ì™¸ê³„ì¸,ì“°ë ˆê¸°,ëª©ìš•íƒ•,ìƒ‰ì—°í•„,ë™í™”ì±…,ì§€êµ¬ë³¸,ìš°ì£¼ì„ ,ë„ì‹œë½,ë³„ìë¦¬,ìƒìƒë ¥,ìì „ê±°,êµ¬ì¡°ëŒ€,ì¥ë‚œê°,êµ¬ê¸‰ì°¨,ìë™ì°¨,ìŒì‹ì ,ì‹¬ë¶€ë¦„,ë‘˜ë ˆê¸¸,ì§€ìš°ê°œ`.split(','));
    let words4 = shuffle(`ìˆ˜ìˆ˜ê»˜ë¼,ë°±ê³¼ì‚¬ì „,í˜¸ë‘ë‚˜ë¹„,í•´ë°”ë¼ê¸°,ìì‘ë‚˜ë¬´,í—ˆìˆ˜ì•„ë¹„,ëŒ€í•œë¯¼êµ­,ë¯¸ë„ëŸ¼í‹€,ë°€ì§šëª¨ì,í• ì•„ë²„ì§€,ë°”ë‹¤í‘œë²”,ì‚¬ìŠ´ë²Œë ˆ,ë”±ì •ë²Œë ˆ,ë¬´ë‹¹ë²Œë ˆ,ê·€ëšœë¼ë¯¸,ë†€ì´ê³µì›,ì–´ë¦°ì´ì§‘,ì–´ë¦°ì´ë‚ ,ì´ˆë“±í•™êµ,ì´ˆë“±í•™ìƒ,ê³ ë“±í•™êµ,ê³ ë“±í•™ìƒ,ì—‰ë§ì§„ì°½,ì€ê·¼ìŠ¬ì©,í—ë ˆë²Œë–¡,ë¶ˆê½ƒë†€ì´,ì•¼ìƒë™ë¬¼,ë¹„ë°€ë²ˆí˜¸,ë¹„ë°€ê¸°ì§€,ê°€ì¡±ì—¬í–‰,ì‚¬ê³¼ë‚˜ë¬´,ì¹´ë©œë ˆì˜¨,ì˜ˆë°©ì£¼ì‚¬,ì¼ê¸°ì˜ˆë³´,ë¯¸ì„¸ë¨¼ì§€,ì•ˆì „ìš´ì „,ë‚˜ë¬´ëŠ˜ë³´,ë°”ì´ì˜¬ë¦°,ìŠ¤ë§ˆíŠ¸í°,ì¢…ì´ì ‘ê¸°,ì¸ê³µì§€ëŠ¥,ëª¨ë˜ì‹œê³„,ì†ëª©ì‹œê³„,ë°±ì„¤ê³µì£¼,ì¸ì–´ê³µì£¼,ê³ ìŠ´ë„ì¹˜,ì“°ë ˆê¸°í†µ,ëœì¥ì°Œê°œ,ê¹€ì¹˜ì°Œê°œ,ìŠ¤íŒŒê²Œí‹°,ë­‰ê²Œêµ¬ë¦„,ì†¡ì´ë²„ì„¯,í”ë“¤ì˜ì,ì•„ë¦„ë“œë¦¬`.split(','));

    function quiz(answer) {
        clear();
        let el_answer = document.querySelector('#answer');
        let chars = answer.split('');
        let jamos = [];
        for(let ch of chars) {
            let decomposed = Array.from(ch.normalize('NFD'));
            jamos.push(...decomposed);
        }
        let shuffled = shuffle(jamos);
        let x = jamo_size, y = 200;
        for(let jm of shuffled) {
            let el_jamo = document.createElement('div');
            el_jamo.dataset.jamo = jm;
            el_jamo.classList.add('jamo');
            el_jamo.innerText = jm;
            document.querySelector('#stage').appendChild(el_jamo);
            el_jamo.style.transform = `translate(${x}px, ${y}px)`;
            el_jamo.dataset.x = x;
            el_jamo.dataset.y = y;
            if(x + jamo_size * 1.5 > window.innerWidth) {
                y += jamo_size;
                x = jamo_size;
            }
            else {
                x += jamo_size;
            }
        }

        hide_answer();
    }

    document.querySelector('#quiz').addEventListener('click', () => {
        let el_answer = document.querySelector('#answer');
        quiz(el_answer.value);
    });

    document.querySelector('#random2').addEventListener('click', () => {
        let word = words2.pop();
        words2.unshift(word);
        quiz(word);
        document.querySelector('#answer').value = word;
    });

    document.querySelector('#random3').addEventListener('click', () => {
        let word = words3.pop();
        words3.unshift(word);
        quiz(word);
        document.querySelector('#answer').value = word;
    });

    document.querySelector('#random4').addEventListener('click', () => {
        let word = words4.pop();
        words4.unshift(word);
        quiz(word);
        document.querySelector('#answer').value = word;
    });

    function clear() {
        let stage = document.querySelector('#stage');
        stage.innerHTML = '';
        document.querySelector('#test').innerHTML = '';
    }

    document.querySelector('#reset').addEventListener('click', () => {
        document.querySelector('#answer').value = '';
        clear();
    });

    el_showhide.addEventListener('click', (event) => {
        if(el_showhide.dataset.status === 'show') {
            hide_answer();
        } else {
            show_answer();
        }
    });
    
    let selectedJamo = null;
    let offsetX = 0, offsetY = 0;

    function handleStart(event) {
        let target = event.target;
        if(target.classList.contains('jamo')) {
            selectedJamo = target;
            let rect = selectedJamo.getBoundingClientRect();

            if (event.type === 'mousedown') {
                offsetX = event.pageX - rect.left;
                offsetY = event.pageY - rect.top;
            } else if (event.type === 'touchstart') {
                offsetX = event.touches[0].pageX- rect.left;
                offsetY = event.touches[0].pageY - rect.top;
                
            }
            selectedJamo.style['-webkit-text-stroke'] = '3px blue';
            selectedJamo.style.color = 'blue';
        }
    }

    function handleMove(event) {
        if(selectedJamo) {
            let x, y;
            if (event.type === 'mousemove') {
                x = event.pageX - offsetX;
                y = event.pageY - offsetY;
            } else if (event.type === 'touchmove') {
                // event.preventDefault();
                x = event.touches[0].pageX - offsetX;
                y = event.touches[0].pageY - offsetY;
            }
            selectedJamo.style.transform = `translate(${x}px, ${y}px)`;
            selectedJamo.dataset.x = x;
            selectedJamo.dataset.y = y;
            selectedJamo.style['-webkit-text-stroke'] = '3px blue';
            selectedJamo.style.color = 'blue';
            compose();
        }
        else {
            if(event.target.classList.contains('jamo')) {
                event.target.style['-webkit-text-stroke'] = '3px blue';
                event.target.style.color = 'blue';
            }
        }
    }

    document.addEventListener('mouseout', (event) => {
        if(event.target.classList.contains('jamo')) {
            event.target.style['-webkit-text-stroke'] = '';
            event.target.style.color = '';
        }
    });

    function handleEnd(event) {
        if(selectedJamo) {
            selectedJamo.style['-webkit-text-stroke'] = '';
            selectedJamo.style.color = '';
            is_correct();
        }
        selectedJamo = null;
    }

    function resize() {
        // ê°€ë¡œê°€ ì„¸ë¡œë³´ë‹¤ ì‘ìœ¼ë©´ ê¸°ì¡´ì˜ style ruleì—ì„œ classê°€ jamo ì¸ê²ƒì˜ font-sizeë¥¼ 50pxë¡œ ì„¤ì •
        if(window.innerWidth < window.innerHeight) {
            jamo_size = 50;
        }  
        else {
            jamo_size = 100;
        }
        let styleSheet = document.styleSheets[0];
        let cssRules = Array.from(styleSheet.cssRules || styleSheet.rules);
        let rule = cssRules.filter(x => x.selectorText == '.jamo')[0];
        rule.style.fontSize = `${jamo_size}px`;
    }

    window.addEventListener('resize', (event) => {
        setTimeout(() => {
            resize();
        }, 100);
    });

    window.addEventListener("orientationchange", (event) => {
        setTimeout(() => {
            resize();
        }, 100);
    });

    document.addEventListener('mousedown', handleStart);
    document.addEventListener('touchstart', handleStart);

    document.addEventListener('mousemove', handleMove);
    document.addEventListener('touchmove', handleMove);

    document.addEventListener('mouseup', handleEnd);
    document.addEventListener('touchend', handleEnd);

    document.addEventListener('contextmenu', (event) => {
        event.preventDefault();
        //event.stopPropagation();
    });

    function getJamoType(char) {
        const codePoint = char.codePointAt(0);

        // ì´ˆì„± (Leading consonants): U+1100 â€“ U+1112 (19ì)
        // á„€á„á„‚á„ƒá„„á„…á„†á„‡á„ˆá„‰á„Šá„‹á„Œá„á„á„á„á„‘á„’
        if (codePoint >= 0x1100 && codePoint <= 0x1112) {
            return 0;
        }

        // ì¤‘ì„± (Vowels): U+1161 â€“ U+1175 (21ì)
        // á…¡á…¢á…£á…¤á…¥á…¦á…§á…¨á…©á…ªá…«á…¬á…­á…®á…¯á…°á…±á…²á…³á…´á…µ
        if (codePoint >= 0x1161 && codePoint <= 0x1175) {
            return 1;
        }

        // ì¢…ì„± (Trailing consonants): U+11A8 â€“ U+11C2 (27ì), U+11A7 (ì¢…ì„±ì´ ì—†ëŠ” ê²½ìš°)
        // á†¨á†©á†ªá†«á†¬á†­á†®á†¯á†°á†±á†²á†³á†´á†µá†¶á†·á†¸á†¹á†ºá†»á†¼á†½á†¾á†¿á‡€á‡á‡‚
        if ((codePoint >= 0x11A8 && codePoint <= 0x11C2) || codePoint === 0x11A7) {
            return 2;
        }

        // const syllable = 0xAC00 + (choIndex * 21 * 28) + (jungIndex * 28) + jongIndex;

        return -1;
    }

    function compose() {
        // á…¡á…¢á…£á…¤á…¥á…¦á…§á…¨á…©á…ªá…«á…¬á…­á…®á…¯á…°á…±á…²á…³á…´á…µ
        let type_v = 'á…¡á…¢á…£á…¤á…¥á…¦á…§á…¨á…µ'.split('');
        let type_h = 'á…©á…ªá…«á…¬á…­á…®á…¯á…°á…±á…²á…³á…´'.split('');

        el_chars = [];

        let el_jamos = Array.from(document.querySelectorAll('.jamo')).sort((a, b) => {
            let rect_a = a.getBoundingClientRect();
            let rect_b = b.getBoundingClientRect();
            return rect_a.left - rect_b.left;
        });

        let print = '';

        for(let el_jamo of el_jamos) {
            let jamo = el_jamo.dataset.jamo;
            let jamo_type = getJamoType(jamo);
            let el_rect = el_jamo.getBoundingClientRect();
            let x = el_rect.left + el_rect.width / 2;
            let y = el_rect.top + el_rect.height / 2;
            let min_d = Number.MAX_VALUE;
            let el_cho = null;
            if(jamo_type === 1) { // ì¤‘ì„± ëª¨ìŒ
                for(let other_jamo of el_jamos) {
                    if(getJamoType(other_jamo.dataset.jamo) === 1) continue;
                    let other_rect = other_jamo.getBoundingClientRect();
                    let other_x = other_rect.left + other_rect.width / 2;
                    let other_y = other_rect.top + other_rect.height / 2; 
                    if(el_jamo !== other_jamo) {
                        let dx = other_x - x;
                        let dy = other_y - y;
                        let d = Math.sqrt(dx * dx + dy * dy);
                        if(type_v.includes(jamo)) { // ã… type
                            if(dx < 0 && (other_y > y - jamo_size/2 && other_y < y + jamo_size/2)) {
                                if(d < min_d) {
                                    min_d = d;
                                    el_cho = other_jamo;
                                }
                            }
                        } else if(type_h.includes(jamo)) { // ã…— type
                            if(dy < 0) {
                                if(d < min_d) {
                                    min_d = d;
                                    el_cho = other_jamo;
                                }
                            }
                        }        
                    }
                }

                if(el_cho) {
                    el_chars.push({
                        cho: el_cho,
                        jung: el_jamo,
                        jong: null,
                    });
                }
                window.el_chars = el_chars;
            }
        }

        let common_cho = ['á„€', 'á„', 'á„‚', 'á„ƒ', 'á„…', 'á„†', 'á„‡', 'á„‰', 'á„Š', 'á„‹', 'á„Œ', 'á„', 'á„', 'á„', 'á„‘', 'á„’'];
        let common_jong = ['á†¨', 'á†©', 'á†«', 'á†®', 'á†¯', 'á†·', 'á†¸', 'á†º', 'á†»', 'á†¼', 'á†½', 'á†¾', 'á†¿', 'á‡€', 'á‡', 'á‡‚'];

        for(let el_char of el_chars) {
            let rect = el_char.jung.getBoundingClientRect();
            let left = el_char.cho.getBoundingClientRect().left - jamo_size/2;
            let right = el_char.jung.getBoundingClientRect().right +  jamo_size/2;
            let candidates = [];
            for(let other_jamo of el_jamos) {
                if(getJamoType(other_jamo.dataset.jamo) === 1) continue;
                let other_rect = other_jamo.getBoundingClientRect();
                let other_x = other_rect.left + other_rect.width / 2;
                let other_y = other_rect.top + other_rect.height / 2;
                if(other_x > left && other_x < right) {
                    candidates.push(other_jamo);    
                }
            }
            if(candidates.length > 0) {
                candidates.sort((a, b) => b.getBoundingClientRect().top - a.getBoundingClientRect().top);
                if(el_char.cho !== candidates[0]) {
                    el_char.jong = candidates[0];
                }
            }

            let cho = el_char.cho.dataset.jamo;
            let jung = el_char.jung.dataset.jamo;
            let jong = el_char.jong ? el_char.jong.dataset.jamo : '';
            if(getJamoType(el_char.cho.dataset.jamo) === 2) { // ì´ˆì„± ìë¦¬ì— ëª¨ì–‘ì´ ê°™ì€ ì¢…ì„±ì´ ì˜¤ë©´
                let idx = common_jong.indexOf(el_char.cho.dataset.jamo);
                cho = common_cho[idx];
            }

            if(el_char.jong) {
                if(getJamoType(el_char.jong.dataset.jamo) === 0) { // ì¢…ì„± ìë¦¬ì— ëª¨ì–‘ì´ ê°™ì€ ì´ˆì„±ì´ ì˜¤ë©´
                    let idx = common_cho.indexOf(el_char.jong.dataset.jamo);
                    jong = common_jong[idx];
                }
            }
            
            if(!cho) cho = '';
            if(!jung) jung = '';
            if(!jong) jong = '';

            print += cho + jung + jong;
        }

        document.querySelector('#test').textContent = print;
    }

    function is_correct() {
        let ans = document.querySelector('#answer').value;
        let answer = document.querySelector('#answer').value.normalize('NFD');
        let test = document.querySelector('#test').textContent.normalize('NFD');
        if(answer == test) {
            for(let el_jamo of document.querySelectorAll('.jamo')) {
                let hue = Math.random() * 360;
                el_jamo.style.textShadow = `0px 0px ${jamo_size/4}px hsl(${hue}, 100%, 70%)`;
            }
            show_answer();
            document.querySelector('#test').innerHTML = `<a href="https://ko.wikipedia.org/wiki/${ans}" target="_blank">${ans}</a>`;
        }
        else {
            for(let el_jamo of document.querySelectorAll('.jamo')) {
                el_jamo.style.textShadow = '';
            }
        }
    }

    resize();
</script>