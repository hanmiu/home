<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ì•”í˜¸ ì°¾ê¸° í€´ì¦ˆ</title>
    <style>
        body {
            padding: 50px;
        }
        #pw_setup {
            margin-bottom: 20px;
        }
        #try {
            position: absolute;
            left: 0px;
            top: 0px;
            width: 100vw;
            height: 100vh;
            text-align: center;
            transform: translateY(40%);;
        }
        #try_answer {
            margin-right: 10px;
            padding: 10px;
            font-size: 40px;
        }
        #try_btn {
            padding: 10px 20px;
            font-size: 40px;
        }
        #result {
            margin-top: 30px;
            font-size: 50px;
        }
    </style>
</head>
<body>
    <div id="pw_setup">
        <input type="text" id="answer" placeholder="ìˆ¨ê¸¸ ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”." spellcheck="false" autocomplete="off">
        <input type="text" id="password" placeholder="ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." spellcheck="false" autocomplete="off">
        <button id="hide">ìˆ¨ê¸°ê¸°</button>
    </div>
    <div id="try">
        <input type="text" id="try_answer" placeholder="ì°¾ì€ ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”." spellcheck="false" autocomplete="off">
        <button id="try_btn">í™•ì¸</button>
        <div id="result"></div>
    </div>

    <script>
        let el_answer = document.querySelector('#answer');
        let el_password = document.querySelector('#password');
        let bt_hide = document.querySelector('#hide');
        let el_try_answer = document.querySelector('#try_answer');
        let bt_try = document.querySelector('#try_btn');
        let el_result = document.querySelector('#result');

        let answer_value = '';
        let password_value = '';
        let fail_count = 0;

        let utter = new SpeechSynthesisUtterance();
        utter.lang = 'ko';

        hide.addEventListener('click', function() {
            answer_value = el_answer.value;
            password_value = el_password.value;
            el_answer.value = '';
            el_password.value = '';
            if(answer_value.length > 0) {
                utter.text = 'ì •ë‹µì„ ìˆ¨ê²¼ìŠµë‹ˆë‹¤.';
                if(password_value.length > 0) {
                    utter.text = `ì •ë‹µê³¼ ì•”í˜¸ë¥¼ ìˆ¨ê²¼ìŠµë‹ˆë‹¤.`;
                }
            }
            speechSynthesis.speak(utter);
            fail_count = 0;
        });

        bt_try.addEventListener('click', function() {
            result.textContent = '';
            if(answer_value.length === 0) {
                result.textContent = 'ìˆ¨ê¸´ ì •ë‹µì´ ì—†ìŠµë‹ˆë‹¤.';
            }
            else {
                if (el_try_answer.value === answer_value) {
                    if(password_value.length === 0) {
                        el_result.innerHTML = `ğŸ’¡ ì •ë‹µì…ë‹ˆë‹¤.`; 
                    }
                    else {
                        el_result.innerHTML = `ğŸ’¡ ì •ë‹µì…ë‹ˆë‹¤, <br>ğŸ” ì•”í˜¸ëŠ” <span style="color: blue">${password_value}</span> ì…ë‹ˆë‹¤.`;
                    }
                } else {
                    el_result.textContent = 'âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
                    fail_count += 1;
                    if(fail_count > 0 && answer_value.length > 0) {
                        hint();
                    }
                }
            }
            if(el_result.textContent.length > 0) {
                utter.text = result.textContent.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu, '');
                speechSynthesis.speak(utter);
            }
        });

        function hint() {
            let html = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.`;
            if(fail_count === 2) {
                html = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤,`;
                html += `ì •ë‹µì˜ <br>ê¸€ì ìˆ˜ëŠ” ${answer_value.length}ì…ë‹ˆë‹¤,`;
                html += `<br>ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.`;
            }
            else if(fail_count === 3 || fail_count === 4) {
                let answer_elements = Array.from(answer_value);
                let try_elements = Array.from(try_answer.value);

                let intersection = try_elements.filter(element => answer_elements.includes(element));

                let count = intersection.length;
                let elements = intersection.join(', ');

                html = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤,`;
                if(count > 0) {
                    html += `<br>ë§ì¶˜ ê¸€ì ìˆ˜ëŠ” ${count} ì´ê³ , <br>ë§ì¶˜ ê¸€ìëŠ” ${elements} ì…ë‹ˆë‹¤,`;
                }
                else {
                    html += `<br>ë§ì¶˜ ê¸€ì ìˆ˜ëŠ” ${count} ì…ë‹ˆë‹¤,`;
                }
                html += `<br>ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.`;
            }
            else if(fail_count >= 5) {
                let answer_elements = Array.from(answer_value.normalize('NFD')).filter(char => !/[\u0300-\u036f]/.test(char));
                let try_elements = Array.from(try_answer.value.normalize('NFD')).filter(char => !/[\u0300-\u036f]/.test(char));

                let intersection = try_elements.filter(element => answer_elements.includes(element));

                let count = intersection.length;
                let elements = intersection.join(', ');

                html = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤,`;
                if(count > 0) {
                    html += `<br>ë§ì¶˜ ìëª¨ ìˆ˜ëŠ” ${count} ì´ê³ , <br>ë§ì¶˜ ìëª¨ëŠ” ${elements} ì…ë‹ˆë‹¤,`;
                }
                else {
                    html += `<br>ë§ì¶˜ ìëª¨ ìˆ˜ëŠ” ${count} ì…ë‹ˆë‹¤,`;
                }
                html += `<br>ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.`;
            }
            el_result.innerHTML = html;
        }
    </script>
</body>
</html>
