<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
<title>신기한 여름방학</title>
<style>
  body {
    margin: 0;
    user-select: none;
    overflow: hidden;
    font-family: sans-serif;
  }
  
  #title {
    position: fixed;
    left: 0px;
    top: 0px;
    display: flex;
    box-sizing: border-box;
    width: 100vw;
    height: 10vh;
    background-color: #e9fff8;
    background-image: url(./images/summer_vacation.svg);
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    align-items: center;
    justify-content: center;
    font-size: 5vh;
    z-index: 100;
  }
  
  #spots {
    position: fixed;
    left: 0px;
    top: 10vh;
    box-sizing: border-box;
    width: 25vw;
    height: 90vh;
    background-color: #b0ffe7;
    overflow-y: scroll;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .spot {
    display: inline-block;
    width: 16vw;
    height: 16vw;
    margin: 4vw 0.5vw 0vw 3vw;
    background-color: azure;
    border-radius: 20vw;
    border: 1.5vw solid #90e5e5;
    background-size: contain;
    transition: 0.5s border, 1s box-shadow;
  }
  
  .spot[curr='1'] {
    border: 1.5vw solid #8900ff;
    box-shadow: 0px 0px 10px #ff3bd9;
  }
  
  .emptyspot {
    display: inline-block;
    width: 16vw;
    height: 16vw;
    margin: 4vw 0.5vw 0vw 3vw;
  }
  
  #content {
    position: fixed;
    left: 25vw;
    top: 10vh;
    box-sizing: border-box;
    width: 75vw;
    height: 70vh;
    background-color: #fffcb0;
    overflow-y: scroll;
    user-select: none;
    -webkit-user-select: none;
    background-size: contain;
    background-repeat: no-repeat;
  }
  
  #message {
    padding: 2vh;
    width: 65vw;
    font-size: 3vh;
    font-family: 'Do Hyeon', sans-serif;
    line-height: 1.5em;
    color: #434343;
    float: left;
  }
  
  strong {
    color: #8900ff;
    text-shadow: 0px 0px 2px #c179ff;
  }
  
  #control {
    position: fixed;
    left: 25vw;
    bottom: 0vh;
    box-sizing: border-box;
    width: 75vw;
    height: 20vh;
    background-color: #d1b0ff;
    user-select: none;
    -webkit-user-select: none;
  }
  
  #notice {
    color: aqua;
    font-size: 10vh;
  }
  
  #dice-holder {
    position: absolute;
    left: 0vh;
    top: 0vh;
    width: 20vh;
    height: 20vh;
  }
  
  #dice {
    position: absolute;
    left: 4vh;
    top: 4vh;
    width: 12vh;
    height: 12vh;
    background-color: beige;
    background-image: url(./dice/dice.svg);
    border-radius: 1vh;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: 0vh 0vh;
    border: 1px solid #bdbda7;
  }
  
  #roll-info-holder {
    position: absolute;
    left: 20vh;
    top: 0vh;
    width: calc(100vw - 20vh - 25vw);
    height: 20vh;
    background-color: #b0ffe7;
  }
  
  #roll-info {
    padding: 2vh;
    font-family: 'Do Hyeon', sans-serif;
    font-size: 2.5vh;
    line-height: 1.5em;
  }
  
  #info {
    font-size: 20px;
  }
  
  .thumb {
    width: 3vh;
    height: 3vh;
    border-radius: 2vh;
  }
  
  .thumb-big {
    margin-right: 1vh;
    width: 20vh;
    height: 20vh;
    float: left;
  }
  
  .thumb-mid {
    margin-left: 1vh;
    margin-right: 2vh;
    width: 5vh;
    height: 5vh;
    transform: translate(0.0, 0.9vh) scale(1.5);
  }
  
  
</style>
<body>
  <div id="title"></div>
  <div id="spots"></div>
  <div id="content">
    <div id="message">
      왼쪽 그림을 스크롤 하면 보드게임의 칸을 살펴보며 이동할 수 있습니다. 아래 주사위🎲를 클릭해서 시작해 보세요. QR코드가 <strong>0</strong>번째 칸입니다.
    </div>
  </div>
  <div id="control">
    <div id="dice-holder">
      <div id="dice"></div>
      <div id="roll-info-holder">
        <div id="roll-info"><strong>← 🎲</strong>를 클릭해서 나온 숫자 만큼 앞으로 갑니다! QR코드에서 출발하세요~</div>
      </div>
    </div>
    
  </div>
</body>
<script>
  let el_spots = document.querySelector('#spots');
  let el_content = document.querySelector('#content');
  let el_message = document.querySelector('#message');
  let el_dice = document.querySelector('#dice');
  let el_roll_info = document.querySelector('#roll-info');
  
  let spots = [];
  
  let frame_count = 0;
  let n_rolling = 0;
  let current_face = 0;
  let current_spot_idx = 0;
  
  let effs = '돌돌~,빙글~,뱅글,딱~'.split(',');
  
  for(let i = 0; i < 40; i++) {
    let el_spot = document.createElement('div');
    if(i !== 39) {
      el_spot.className = 'spot';
      el_spot.style['background-image'] = `url(./spots/${i}.png)`;
      el_spot.onclick = fire;  
    }
    else {
      el_spot.className = 'emptyspot';
    }
    spots.push(el_spot);
    el_spots.appendChild(el_spot);
  }
  
  function halo(n) {
    for(let i = 0; i < spots.length; i++) {
      spots[i].setAttribute('curr', '');
    }
    spots[n].setAttribute('curr', '1');
  }
  
  function fire(e) {
    let idx = spots.indexOf(e.target);
    halo(idx);
    current_spot_idx = idx;
    after_fire();
    el_roll_info.innerHTML = `위 안내를 따른 후, 🎲를 굴려서 진행합니다.`;
  }
  
  function thumb(idx) {
    let url = `./spots/${idx}.png`;
    let img = `<img class="thumb-mid" src="${url}">`;
    return img;
  }
  
  function after_fire() {
    let idx = current_spot_idx;
    let img_url = `./spots/${idx}.png`;
    let img = `<img class="thumb-big" src="${img_url}">`;
    
    //let next_idx = Math.max(Math.min(idx + current_face, spots.length - 1), 0);
    let NB = `<a href="https://www.youtube.com/channel/UCPlwvN0w4qFSP1FllALB92w" target="_blank">넘버블록스</a>`;
    
    let msg = `<br><strong>${idx}</strong>번째 칸에 <br>도착했습니다.<br><br><br>`;
    switch(idx) {
      case 0:
        msg += `출발 지점입니다. 아래 🎲를 클릭해서 보드게임을 시작해 보세요.`;
        break;
      case 1:
        msg += `아직 아무일도 일어나지 않았습니다. <br><br>'신기한 생물 사전'에 참여하다보면, 다음에는 뭔가 바뀔지도 몰라요. 🎲를 굴려서 계속 이어가세요.`;
        break;
      case 2:
        msg += `아직 아무일도 일어나지 않았습니다. <br><br>'신기한 생물 사전'에 참여하다보면, 다음에는 뭔가 바뀔지도 몰라요. 🎲를 굴려서 계속 이어가세요.`;
        break;
      case 3:
        msg += `<strong>+1</strong>이 나왔군요! 한 칸 앞인 ${thumb(idx+1)}로 가야합니다.`;
        break;
      case 4:
        if(Math.random() > 0.5) {
          msg += `<strong>솜꽃</strong>이가 물어봅니다.<br(>솜꽃이는 '목화'의 별명이에요.) <br><br>"오늘 이를 잘 닦았니?" 이를 깨끗하게 잘 닦았으면 🎲를 굴려서 계속 이어가세요.`;
        }
        else {
          msg += `<strong>솜꽃</strong>이가 물어봅니다.<br>(솜꽃이는 '목화'의 별명이에요.) <br><br>"오늘 손을 깨끗하게 닦았니?" 손이 깨끗하면 🎲를 굴려서 계속 이어가세요.`;  
        }
        break;
      case 5:
        msg += `<strong>-1</strong>이 나왔군요! 한 칸 뒤인 ${thumb(idx-1)}로 가야합니다.`;
        break;
      case 6:
        msg += `<strong>+2</strong>가 나왔군요! 두 칸 앞인 ${thumb(idx+2)}로 가야합니다. <br><br>숫자에 관해 궁금하면 ${NB}를 참고하세요. 지금 말고 나중에 엄마 아빠와 약속을 정하고 보기로 해요.`;
        break;
      default:
        msg += `... 아직 준비중 입니다.<br><br> 지금은 🎲를 굴려서 계속 이어가세요. 조금 있다가 다시 해보면 내용이 나올거에요.`;
        break;
    }
    
    el_message.innerHTML = `${img}${msg}`;
  }
  
  function jump_to(n) {
    if(spots[n]) {
      spots[n].scrollIntoView(false);
    }
  }
  
  function roll() {
    return Math.random() * 6 + 1 | 0;
  }
  
  function roll_the_dice() {
    current_face = roll();
    el_dice.style["background-position"] = `${-(current_face-1)*12}vh 0vh`;
  }
  
  function after_roll() {
    let url = `./spots/${current_face + current_spot_idx}.png`;
    let img = `<img class="thumb" src="${url}">`;
    el_roll_info.innerHTML = `<strong>${current_face}</strong>칸 앞으로 이동한 후 그 칸의 그림${img}을 클릭하세요!`;
  }
  
  el_dice.onclick = function(e) {
    el_dice.style['transition'] = `2s transform, 0.5s background-color`;
    el_dice.style['transform'] = 'rotate(720deg)';
    n_rolling = 10 + Math.random() * 3 | 0;
    el_roll_info.innerHTML = '';
  }
  
  function update() {
    if(n_rolling > 0) {
      if(frame_count % 10 === 0) {
        let colors = '#ff3a3a,orange,yellow,yellowgreen,#448afa,#3806a8,#bf00bf'.split(',');
        el_dice.style['background-color'] = colors[Math.random() * colors.length | 0];
        el_roll_info.innerHTML += effs[Math.random() * effs.length | 0] + ' ';
        roll_the_dice();
        n_rolling -= 1;
        if(n_rolling === 0) {
          el_dice.style['background-color'] = 'beige';
          el_dice.style['transition'] = `0.5s background-color`;
          setTimeout(() => {
            el_dice.style['transform'] = 'rotate(0deg)';
            after_roll();
          }, 500);
        }
      }
    }
    frame_count += 1;
  }
  
  function loop() {
    update();
    requestAnimationFrame(loop);
  }
  
  function init() {
    
    let params = new URLSearchParams(location.search.slice(1));
    let title = params.get('w');
    let desc = '';
    
    switch(params.get('w')) {
      case 'abc':
        desc = `어떤 미션`;
        break;
      case 'def':
        desc = `주사위를 굴려 ${dice_states[roll()-1]}이 나오면 샛길로 점프`;
        break;
      case 'hij':
        desc = `설정한 약속 실행하기`;
        break;
      case 'G':
        desc = `Goal`;
        // 탐험보고
        break;
    }
    
    // el_info.textContent = desc;
    
    current_face = roll();
    el_dice.style["background-position"] = `${-(current_face-1)*12}vh 0vh`;
    
    halo(current_spot_idx);
    
    loop();
  }
  
  window.onload = init;
</script>