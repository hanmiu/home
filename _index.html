<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>한미유치원</title>
<!--<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR&display=swap" rel="stylesheet">-->
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;400;600&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-size: 14px;
  }
  
  a {
    color: black;
    text-decoration: none;
    border-bottom: 1px solid black;
    transition: 0.2s;
  }
  
  a.no-underline {
    border-bottom: 0px solid black;
    background-color: transparent;
  }
  
  a:hover {
    background-color: #bdf8ff;
    /* text-shadow: 0px 0px 5px #95f3ff; */
  }
  
  a.no-underline:hover {
    background-color: transparent;
  }
  
  a:visited {
    color: black;
  }
  
  #stage {
    margin: auto;
    max-width: 1024px;
    overflow: hidden;
  }
  
  #pebbles {
    width: 100%;
  }
  
  .pebble {
    position: relative;
    font-family: 'Noto Serif KR', serif;
    height: 200px;
    overflow: hidden;
    border-bottom: 1px solid #cecece;
  }
  
  .pebble .layer {
    position: absolute;
    left: 0px;
    top: 0px;
  }
  
  .pebble .subject {
    position: absolute;
    left: 1rem;
    top: 1rem;
    font-size: 3rem;
    font-weight: 400;
  }
  
  .pebble .description {
    position: absolute;
    left: 1.5rem;
    top: 6rem;
    font-size: 1.5rem;
    font-weight: 200;
    /* font-family: 'Noto Serif KR Light', serif;*/
  }
  
  .pebble #description-logo {
    position: relative;
    display: flex;
    margin-top: 6.5rem;
    font-size: 1.5rem;
    justify-content: center;
  }
  
  .pebble .touch {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }
  
  #info {
    display: none;
    position: fixed;
    right: 0px;
    top: 0px;
  }
  
  #detail {
    visibility: hidden;
    width: 100%;
    height: 0;
    font-family: 'Noto Serif KR', serif;
  }
  
  #detail #header {
    position: fixed;
    display: flex;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100px;
    background-color: white;
    z-index: 100;
    cursor: pointer;
  }
  
  #detail #header #back-arrow{
    width: 40px;
    height: 100px;
    padding-left: 1rem;
    padding-top: 1.67rem;
    font-size: 2rem;
    color: #989898;
  }
  
  #detail #header #title {
    margin-top: 1rem;
    font-size: 3rem;
  }
  
  #detail #header #logo {
    /* transform: translate(-10px, -10px); */
  }
  
  #detail #content {
    margin-top: 100px;
    font-size: 1.5rem;
    line-height: 2.25rem;
    padding: 2rem;
  }
  
  #detail #content .subtle {
    font-size: 1.25rem;
    line-height: 1.875rem;
    word-break: break-all;
  }
  
  #detail #content .quote {
    margin-top: 1rem;
    padding-left: 1.5rem;
    font-size: 1rem;
    line-height: 1.5rem;
    color: #6a6a6a;
    word-break: break-all;
    /* border-left: 1px dashed #b5b5b5; */
  }
  
  #detail #content li {
    margin-bottom: 1rem;
  }
  
  #detail #content .full {
    width: 100%;
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }
  
  #footer {
    padding-top: 1rem; 
    padding-bottom: 2rem;
    font-family: 'Noto Serif KR', serif;
    line-height: 1.5rem;
  }

  #footer .subject {
    padding-left: 1rem;
    margin-top: 1rem;
    font-size: 3rem;
  }
  
  #footer .tel {
    padding-left: 2rem;
    margin-top: 2rem;
    font-size: 1rem;
  }
  
  #footer .address {
    padding-left: 2rem;
    margin-top: 1rem;
    font-size: 1rem;
  }
</style>
<body>
  <div id="stage">
    <div id="pebbles">
      <div class="pebble">
        <canvas class="layer" id="c-hanmi" ></canvas>
        <div id="description-logo"><div id="phrase">‘놀이는 어린이의 삶’이라고<br>말해온 역사와 환경</div></div>
        <div class="touch" id="t-hanmi"></div>
      </div>
      <div class="pebble">
        <canvas class="layer" id="c-admission" ></canvas>
        <div class="subject">입학</div>
        <div class="description">2021학년도 입학 안내</div>
        <div class="touch" id="t-admission"></div>
      </div>
      <div class="pebble">
        <canvas class="layer" id="c-thought"></canvas>
        <div class="subject">생각</div>
        <div class="description">한미유치원의 교육에 관한 생각</div>
        <div class="touch" id="t-thought"></div>
      </div>
      <div class="pebble">
        <canvas class="layer" id="c-about_play" ></canvas>
        <div class="subject">놀이</div>
        <div class="description">어린이들의 다양한 놀이</div>
        <div class="touch" id="t-about_play"></div>
      </div>
      <div class="pebble">
        <canvas class="layer" id="c-playground"></canvas>
        <div class="subject">디지털 놀이터</div>
        <div class="description">건강한 미디어 활용</div>
        <div class="touch" id="t-playground"></div>
      </div>
      <div class="pebble">
        <canvas class="layer" id="c-covid19"></canvas>
        <div class="subject">코로나19 대응</div>
        <div class="description">현 상황의 대안, 원격 수업 경험</div>
        <div class="touch" id="t-covid19"></div>
      </div>
      <div id="footer">
        <div class="subject">문의</div>
        <div class="tel"><a href="tel:031-975-6567">031-975-6567</a>, <a href="tel:031-976-6567">031-976-6567</a></div>
        <div class="address"><a href="https://www.google.com/maps/place/%ED%95%9C%EB%AF%B8%EC%9C%A0%EC%B9%98%EC%9B%90/@37.6835995,126.7720682,3a,75y,246.71h,88.2t/data=!3m6!1e1!3m4!1sZsMn1vavuVv2dQoIrgyJXw!2e0!7i13312!8i6656!4m5!3m4!1s0x357c8fe61a842b73:0xe9ca1a051e9682d7!8m2!3d37.6835187!4d126.7717634" target="_blank">경기도 고양시 일산서구 고양대로 686-8</a></div>
      </div>
    </div>
    <div id="detail">
      <div id="header">
        <div id="back-arrow">←</div>
        <div id="title"></div>
      </div>
      <div id="content">
      </div>
    </div>
  </div>
  <div id="info">:-)</div>
</body>
<script>
  let html = {};
</script>
<script src="./javascripts/util.js"></script>
<script src="./javascripts/hanmi_history.js"></script>
<script src="./javascripts/hanmi_admission.js"></script>
<script src="./javascripts/hanmi_thought.js"></script>
<script>
  function css() {
    let domStyle = document.getElementById('domStylee');
    if (domStyle) {
      document.body.removeChild(domStyle);
      return;
    }
    domStyle = document.createElement("style");
    domStyle.setAttribute('id', 'domStylee');
    domStyle.append(
      ['* { color:#0f0!important;outline:solid #f00 1px!important; background-color: rgba(255,0,0,.2) !important; }'],
      ['* * { background-color: rgba(0,255,0,.2) !important; }'],
      ['* * * { background-color: rgba(0,0,255,.2) !important; }'],
      ['* * * * { background-color: rgba(255,0,255,.2) !important; }'],
      ['* * * * * { background-color: rgba(0,255,255,.2) !important; }'],
      ['* * * * * * { background-color: rgba(255,255,0,.2) !important; }'],
      ['* * * * * * * { background-color: rgba(255,0,0,.2) !important; }'],
      ['* * * * * * * * { background-color: rgba(0,255,0,.2) !important; }'],
      ['* * * * * * * * * { background-color: rgba(0,0,255,.2) !important; }'].join()
    );
    document.body.appendChild(domStyle);
  }
  //css();
  
  let el_pebbles = document.querySelector('#pebbles');
  let el_detail = document.querySelector('#detail');
  let el_detail_header = document.querySelector('#detail #header');
  let el_detail_header_title = document.querySelector('#detail #header #title');
  let el_detail_content = document.querySelector('#detail #content');
  let el_footer = document.querySelector('#footer');

  let el_info = document.querySelector('#info');
  
  let ctx_hanmi = document.querySelector('#c-hanmi').getContext('2d');
  let ctx_admission = document.querySelector('#c-admission').getContext('2d');
  let ctx_thought = document.querySelector('#c-thought').getContext('2d');
  let ctx_about_play = document.querySelector('#c-about_play').getContext('2d');
  let ctx_playground = document.querySelector('#c-playground').getContext('2d');
  let ctx_covid19 = document.querySelector('#c-covid19').getContext('2d');
  
  let page_titles = {
    'hanmi': '역사와 환경',
    'admission': '입학',
    'thought': '생각',
    'about_play': '놀이',
    'playground': '디지털 놀이터',
    'covid19': '코로나19 대응',
  };
  
  let ctxs = [
    ctx_hanmi, ctx_admission, ctx_thought, ctx_about_play, ctx_playground, ctx_covid19
  ];
  
  let params = new URLSearchParams(location.search.slice(1));
  
  function touchstart(e) {
    let eX, eY;
    if(e.targetTouches) {
      eX = e.targetTouches[0].pageX;
      eY = e.targetTouches[0].pageY;
	}
    else {
      eX = e.pageX;
      eY = e.pageY;
    }
    
    //el_info.textContent = e.target.id;
    switch(e.target.id) {
      case 't-hanmi':
        current_loop = loop_hanmi;
        break;
      case 't-admission':
        current_loop = loop_admission;
        break;
    }
    /*
    touchX = eX;
    touchY = eY;
    
    mdown = true;
    for(let i = 0; i < jamos.length; i++) {
      let jamo = jamos[i];
      let dx = eX - jamo.x;
      let dy = eY - jamo.y;
      let d = Math.sqrt(dx*dx + dy*dy) + 1e-6;
      if(d < jamo.r) {
        selected_jamo = jamo;
        jamo.vx = 0;
        jamo.vy = 0;
        jamo.to_hue = Math.random() < 0.2 ? Math.random() * 30 | 0 : 100 + Math.random() * 260 | 0;
      }
    }
    */
    //console.log(e.target.parentElement.style.height = '400px');
  }
  
  function touchmove(e) {
    let eX, eY;
    if(e.targetTouches) {
      e.preventDefault();
      eX = e.targetTouches[0].pageX;
      eY = e.targetTouches[0].pageY;
	}
    else {
      eX = e.pageX;
      eY = e.pageY;
    }
    
    switch(e.target.id) {
      case 't-hanmi':
        current_loop = loop_hanmi;
        break;
      case 't-admission':
        current_loop = loop_admission;
        break;
    }
    /*
    touchX = eX;
    touchY = eY;
    
    if(selected_jamo && mdown) {
      selected_jamo.x = eX;
      selected_jamo.y = eY;
    }
    */
  }
  
  /*
  'admission': '입학',
    'thought': '생각',
    'about_play': '놀이',
    'playground': '디지털 놀이터',
    'covid19': '코로나19 대응',
  */
  
  html['about_play'] = `
    <div>놀놀노리~</div>
  `;
  
  html['playground'] = `
    <div>디디디놀노리~</div>
  `;
  
  html['covid19'] = `
    <div>코로나 코로나 원격원격</div>
  `;
  
  function show_detail(b, title) {
    el_detail_header_title.innerHTML = page_titles[title];
    el_detail_content.innerHTML = html[title];
    let rect = el_pebbles.getBoundingClientRect();
    if(b) {
      last_scrollY = window.scrollY;
      window.scrollTo(0, 0);
      el_detail.style.visibility = 'unset';
      el_detail.style.height = 'unset';
      el_pebbles.style.visibility = 'hidden';
      el_pebbles.style.height = '0';
      el_detail_header.style.left = `${rect.left}px`;
    }
    else {
      window.scrollTo(0, last_scrollY);
      el_detail.style.visibility = 'hidden';
      el_detail.style.height = '0';
      el_pebbles.style.visibility = '';
      el_pebbles.style.height = 'unset';
    }
  }
  
  function touchend(e) {
    /*
    mdown = false;
    selected_jamo = null;
    */
  }
  
  let hanmi_history = new HanmiHistory();
  let hanmi_admission = new HanmiAdmission();
  let current_loop = null;
  let last_scrollY = 0;
  let last_width = 0;
  
  function layout() {
    let rect_pebbles = el_pebbles.getBoundingClientRect();
    el_detail_header.style.left = `${rect_pebbles.left}px`;
    if(last_width !== rect_pebbles.width) {
      let els = document.querySelectorAll('.pebble');
    
      for(let i = 0; i < els.length; i++) {
        let el = els[i];
        let rect = el.getBoundingClientRect();
        let canvas = el.querySelector('.layer');
        canvas.width = rect.width;
        canvas.height = rect.height;
      }

      for(let ctx of ctxs) {
        let hue = Math.random() * 360 | 0;
        ctx.fillStyle = `hsl(${hue}deg, 30%, 80%)`;
        ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      }
      last_width = rect_pebbles.width;
    }
    
    
    hanmi_history.draw(ctx_hanmi);
    hanmi_admission.draw(ctx_admission);
  }
  
  function loop_hanmi() {
    hanmi_history.update();
    hanmi_history.draw(ctx_hanmi);
  }
  
  function loop_admission() {
    hanmi_admission.update();
    hanmi_admission.draw(ctx_admission);
  }
  
  function loop(timestamp) {
    if(hanmi_history.frame_count < 1000 && current_loop !== loop_hanmi) {
      loop_hanmi();
    }
    
    if(current_loop) {
      current_loop();
    }
    requestAnimationFrame(loop);
  }
  
  function init() {
    let chars = '가,가,겨,겨,<br>'.split(',');
    let html = '';
    for(let i = 0; i < 200; i++) {
      html += chars[Math.random() * chars.length | 0];
    }
    el_detail_content.innerHTML = html;
    
    let title = params.get('page');
    if(title) {
      show_detail(true, title);
    }
    
    window.addEventListener('mousedown', touchstart);
    window.addEventListener('mouseup', touchend); 
    window.addEventListener('mousemove', touchmove);

    window.addEventListener('touchstart', touchstart);
    window.addEventListener('touchend', touchend);
    window.addEventListener('touchmove', touchmove);

    window.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      e.stopPropagation();
    });

    window.addEventListener('resize', layout);
    window.addEventListener('oreintationchange', layout);
    
    document.querySelectorAll('.touch').forEach((el) => {
      el.addEventListener('click', (e) => {
        el_info.textContent = 'clicked: ' + e.target.id;
        let title = e.target.id.split('t-')[1];
        show_detail(true, title);
      });
    });
    
    el_detail_header.addEventListener('click', (e) => {
      show_detail(false);
    });
    
    current_loop = loop_hanmi;
    
    show_detail(true, 'thought');
    
    layout();
    loop();
  }
  
  init();
</script>